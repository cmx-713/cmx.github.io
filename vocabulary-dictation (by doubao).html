<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ËØ≠ËØçÊ±áÂê¨ÂÜôËÆ≠ÁªÉ üé™üìö</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-1: #6366f1;
            --primary-2: #8b5cf6;
            --secondary: #c4b5fd;
            --light: #f5f3ff;
            --dark: #374151;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --white: #ffffff;
            --shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.1), 0 8px 10px -6px rgba(99, 102, 241, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* È°µÈù¢ÂàáÊç¢Âä®Áîª */
        .page {
            display: none;
            animation: fadeIn 0.5s ease forwards;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ê†áÈ¢òÊ†∑Âºè */
        .app-title {
            text-align: center;
            margin: 30px 0;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 2.5rem;
            position: relative;
        }

        .app-title::after {
            content: 'üé™';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
        }

        .app-subtitle {
            text-align: center;
            color: var(--dark);
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* Âç°ÁâáÊ†∑Âºè */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
        }

        /* ÊåâÈíÆÊ†∑Âºè */
        .btn {
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            color: var(--white);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.2), 0 4px 6px -2px rgba(99, 102, 241, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-1);
            color: var(--primary-1);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-error {
            background: var(--error);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* ÈöæÂ∫¶ÈÄâÊã© */
        .difficulty-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            flex: 1;
            min-width: 120px;
            padding: 20px 10px;
            text-align: center;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            background: var(--white);
            box-shadow: var(--shadow);
        }

        .difficulty-btn:hover {
            transform: translateY(-5px);
        }

        .difficulty-btn.selected {
            border-color: var(--primary-1);
            background: rgba(99, 102, 241, 0.05);
        }

        .difficulty-btn i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-1);
        }

        /* Á≠îÈ¢òÈ°µÈù¢Ê†∑Âºè */
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: var(--secondary);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            width: 0%;
            transition: width 0.3s ease;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer.warning {
            color: var(--warning);
        }

        .timer.danger {
            color: var(--error);
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }

        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-1);
        }

        .chinese-meaning {
            font-size: 1.8rem;
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: var(--light);
            border-radius: 12px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-container {
            margin: 30px 0;
        }

        .word-input {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            transition: var(--transition);
            text-align: center;
        }

        .word-input:focus {
            outline: none;
            border-color: var(--primary-1);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            min-height: 40px;
        }

        .feedback.correct {
            color: var(--success);
            animation: bounce 0.5s ease;
        }

        .feedback.incorrect {
            color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .hint-info {
            text-align: center;
            color: var(--dark);
            margin: 15px 0;
            font-style: italic;
        }

        .letter-count {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-1);
            font-weight: 500;
        }

        /* ÁªìÊûúÈ°µÈù¢Ê†∑Âºè */
        .result-summary {
            text-align: center;
            margin: 30px 0;
        }

        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-1);
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background-color: var(--light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-1);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--dark);
            font-size: 0.9rem;
        }

        .history-list, .mistakes-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .history-item, .mistake-item {
            padding: 12px;
            border-bottom: 1px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child, .mistake-item:last-child {
            border-bottom: none;
        }

        .mistake-word {
            font-weight: bold;
            color: var(--primary-1);
        }

        .mistake-meaning {
            color: var(--dark);
        }

        .answer-list {
            margin: 20px 0;
        }

        .answer-item {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .answer-item.correct {
            background-color: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
        }

        .answer-item.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
        }

        .answer-word {
            font-weight: 500;
        }

        .answer-status {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .answer-status.correct {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .answer-status.incorrect {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        /* ÊµÆÂä®ÂÖÉÁ¥† */
        .floating {
            position: absolute;
            pointer-events: none;
            opacity: 0.6;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* ÈîÆÁõòÂø´Êç∑ÈîÆÊèêÁ§∫ */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            font-size: 0.8rem;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .key {
            background-color: var(--light);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .app-title {
                font-size: 2rem;
            }

            .chinese-meaning {
                font-size: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .keyboard-shortcuts {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .app-title {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .final-score {
                font-size: 2.5rem;
            }
        }

        /* Ê∞¥Ê≥¢Á∫πÊïàÊûú */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple:after {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.5s, opacity 0.8s;
        }

        .ripple:active:after {
            transform: scale(0, 0);
            opacity: 0.3;
            transition: 0s;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÊµÆÂä®Ë£ÖÈ•∞ÂÖÉÁ¥† -->
        <div class="floating" style="top: 10%; left: 5%; font-size: 2rem;">üìö</div>
        <div class="floating" style="top: 20%; right: 8%; font-size: 1.5rem; animation-delay: 1s;">‚ú®</div>
        <div class="floating" style="top: 60%; left: 3%; font-size: 1.8rem; animation-delay: 2s;">üéØ</div>
        <div class="floating" style="top: 70%; right: 5%; font-size: 1.6rem; animation-delay: 3s;">üìñ</div>

        <h1 class="app-title">Ëã±ËØ≠ËØçÊ±áÂê¨ÂÜôËÆ≠ÁªÉ</h1>
        <p class="app-subtitle">ÊèêÂçá‰Ω†ÁöÑËØçÊ±áÈáèÔºåËΩªÊùæÂ∫îÂØπÂ≠¶ÊúØÊåëÊàò ‚ú®</p>

        <!-- Ê¨¢ËøéÈ°µÈù¢ -->
        <div id="welcome-page" class="page active">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary-1);">ÈÄâÊã©ËØçÊ±áÈöæÂ∫¶</h2>
                <p style="text-align: center; margin-bottom: 30px;">ËØ∑ÈÄâÊã©ÈÄÇÂêà‰Ω†ÁöÑËØçÊ±áÈöæÂ∫¶Á∫ßÂà´ÂºÄÂßãËÆ≠ÁªÉ</p>
                
                <div class="difficulty-selection">
                    <div class="difficulty-btn" data-difficulty="basic">
                        <i class="fas fa-seedling"></i>
                        <div>Âü∫Á°ÄËØçÊ±á</div>
                        <small>ÊïôËÇ≤Áõ∏ÂÖ≥Âü∫Á°ÄËØç</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="intermediate">
                        <i class="fas fa-tree"></i>
                        <div>‰∏≠Á∫ßËØçÊ±á</div>
                        <small>Â≠¶ÊúØÁõ∏ÂÖ≥‰∏≠Á∫ßËØç</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="advanced">
                        <i class="fas fa-mountain"></i>
                        <div>È´òÁ∫ßËØçÊ±á</div>
                        <small>Â≠¶ÊúØ‰∏ì‰∏öÈ´òÁ∫ßËØç</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="mixed">
                        <i class="fas fa-random"></i>
                        <div>Ê∑∑ÂêàÊ®°Âºè</div>
                        <small>ÈöèÊú∫Ê∑∑ÂêàÊâÄÊúâÈöæÂ∫¶</small>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button id="start-btn" class="btn ripple">
                        <i class="fas fa-play"></i> ÂºÄÂßãÂê¨ÂÜô
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px; color: var(--primary-1);">üìù ËÆ≠ÁªÉËØ¥Êòé</h3>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>Á≥ªÁªüÂ∞ÜÊòæÁ§∫‰∏≠ÊñáÈáä‰πâÔºåËØ∑ËæìÂÖ•ÂØπÂ∫îÁöÑËã±ÊñáÂçïËØç</li>
                    <li>ÊØè‰∏™ÂçïËØçÊúâ30ÁßíÁöÑÁ≠îÈ¢òÊó∂Èó¥</li>
                    <li>ÂèØ‰ΩøÁî®ÊèêÁ§∫ÂäüËÉΩËé∑ÂèñÂâç‰∏§‰∏™Â≠óÊØçÁöÑÊèêÁ§∫</li>
                    <li>ÂÆåÊàêÊâÄÊúâÂçïËØçÂêéÂ∞ÜÊòæÁ§∫ËØ¶ÁªÜÁöÑÁªüËÆ°ÁªìÊûú</li>
                    <li>ÈîôËØØÁöÑÂçïËØçÂ∞ÜËá™Âä®Âä†ÂÖ•ÈîôÈ¢òÊú¨</li>
                </ul>
            </div>
        </div>

        <!-- Á≠îÈ¢òÈ°µÈù¢ -->
        <div id="quiz-page" class="page">
            <div class="card">
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>

                <div class="top-bar">
                    <div class="timer">
                        <i class="far fa-clock"></i>
                        <span id="time-left">30</span> Áßí
                    </div>
                    <div class="score-display">
                        ÂæóÂàÜ: <span id="current-score">0</span>
                    </div>
                </div>

                <div class="chinese-meaning" id="chinese-meaning">
                    Á≠âÂæÖÂºÄÂßã...
                </div>

                <div class="letter-count">
                    ÂçïËØçÈïøÂ∫¶: <span id="letter-count">0</span> ‰∏™Â≠óÊØç
                </div>

                <div class="input-container">
                    <input type="text" id="word-input" class="word-input" placeholder="ËØ∑ËæìÂÖ•Ëã±ÊñáÂçïËØç..." autocomplete="off">
                </div>

                <div class="feedback" id="feedback"></div>

                <div class="hint-info" id="hint-info">
                    <!-- ÊèêÁ§∫‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>

                <div class="action-buttons">
                    <button id="pronounce-btn" class="btn btn-outline ripple">
                        <i class="fas fa-volume-up"></i> ÂèëÈü≥
                    </button>
                    <button id="hint-btn" class="btn btn-warning ripple">
                        <i class="fas fa-lightbulb"></i> ÊèêÁ§∫
                    </button>
                    <button id="submit-btn" class="btn btn-success ripple">
                        <i class="fas fa-check"></i> Êèê‰∫§
                    </button>
                    <button id="skip-btn" class="btn btn-error ripple">
                        <i class="fas fa-forward"></i> Ë∑≥Ëøá
                    </button>
                </div>

                <div style="text-align: center;">
                    <button id="pause-btn" class="btn btn-sm ripple">
                        <i class="fas fa-pause"></i> ÊöÇÂÅú
                    </button>
                </div>
            </div>
        </div>

        <!-- ÁªìÊûúÈ°µÈù¢ -->
        <div id="result-page" class="page">
            <div class="card">
                <div class="result-summary">
                    <h2>ËÆ≠ÁªÉÂÆåÊàêÔºÅüéâ</h2>
                    <div class="final-score" id="final-score">0</div>
                    <p>ÊÅ≠Âñú‰Ω†ÂÆåÊàê‰∫ÜÊú¨Ê¨°ËØçÊ±áÂê¨ÂÜôËÆ≠ÁªÉ</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-words">0</div>
                        <div class="stat-label">ÊÄªÈ¢òÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correct-words">0</div>
                        <div class="stat-label">Ê≠£Á°ÆÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">Ê≠£Á°ÆÁéá</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="hints-used">0</div>
                        <div class="stat-label">ÊèêÁ§∫‰ΩøÁî®</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="skipped-words">0</div>
                        <div class="stat-label">Ë∑≥ËøáÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="mistake-words">0</div>
                        <div class="stat-label">ÈîôËØØÊï∞</div>
                    </div>
                </div>

                <h3 style="margin: 30px 0 15px; color: var(--primary-1);">Á≠îÈ¢òÊÉÖÂÜµ</h3>
                <div class="answer-list" id="answer-list">
                    <!-- Á≠îÈ¢òÊÉÖÂÜµÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                    <button id="restart-btn" class="btn ripple">
                        <i class="fas fa-redo"></i> ÈáçÊñ∞ÂºÄÂßã
                    </button>
                    <button id="history-btn" class="btn btn-outline ripple">
                        <i class="fas fa-history"></i> Êü•ÁúãÂéÜÂè≤
                    </button>
                    <button id="mistakes-btn" class="btn btn-outline ripple">
                        <i class="fas fa-exclamation-circle"></i> ÈîôÈ¢òÊú¨
                    </button>
                </div>
            </div>
        </div>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈ°µÈù¢ -->
        <div id="history-page" class="page">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--primary-1);">ËÆ≠ÁªÉÂéÜÂè≤ËÆ∞ÂΩï üìú</h2>
                    <button id="back-from-history-btn" class="btn btn-sm ripple">
                        <i class="fas fa-arrow-left"></i> ËøîÂõû
                    </button>
                </div>

                <div class="history-list" id="history-list">
                    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="clear-history-btn" class="btn btn-error btn-sm ripple">
                        <i class="fas fa-trash"></i> Ê∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩï
                    </button>
                </div>
            </div>
        </div>

        <!-- ÈîôÈ¢òÊú¨È°µÈù¢ -->
        <div id="mistakes-page" class="page">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--primary-1);">ÈîôÈ¢òÊú¨ ‚ùå</h2>
                    <button id="back-from-mistakes-btn" class="btn btn-sm ripple">
                        <i class="fas fa-arrow-left"></i> ËøîÂõû
                    </button>
                </div>

                <p style="margin-bottom: 20px;">ËøôÈáåÊî∂ÈõÜ‰∫Ü‰Ω†ÊâÄÊúâÁ≠îÈîôÁöÑÂçïËØçÔºåÂèØ‰ª•‰∏ãËΩΩËøõË°åÈíàÂØπÊÄßÂ§ç‰π†„ÄÇ</p>

                <div class="mistakes-list" id="mistakes-list">
                    <!-- ÈîôÈ¢òÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                    <button id="download-mistakes-btn" class="btn ripple">
                        <i class="fas fa-download"></i> ‰∏ãËΩΩÈîôÈ¢òÊú¨ (CSV)
                    </button>
                    <button id="clear-mistakes-btn" class="btn btn-error btn-sm ripple">
                        <i class="fas fa-trash"></i> Ê∏ÖÁ©∫ÈîôÈ¢òÊú¨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈîÆÁõòÂø´Êç∑ÈîÆÊèêÁ§∫ -->
    <div class="keyboard-shortcuts" id="keyboard-shortcuts">
        <div><span class="key">Á©∫Ê†º</span> ÊöÇÂÅú/ÁªßÁª≠</div>
        <div><span class="key">ÂõûËΩ¶</span> Êèê‰∫§</div>
        <div><span class="key">H</span> ÊèêÁ§∫</div>
        <div><span class="key">S</span> Ë∑≥Ëøá</div>
    </div>

    <script>
        // ËØçÊ±áÂ∫ì
        const vocabulary = {
            basic: [
                { english: "student", chinese: "Â≠¶Áîü" },
                { english: "teacher", chinese: "ÊïôÂ∏à" },
                { english: "classroom", chinese: "ÊïôÂÆ§" },
                { english: "book", chinese: "‰π¶" },
                { english: "exam", chinese: "ËÄÉËØï" },
                { english: "homework", chinese: "‰Ωú‰∏ö" },
                { english: "library", chinese: "Âõæ‰π¶È¶Ü" },
                { english: "university", chinese: "Â§ßÂ≠¶" },
                { english: "course", chinese: "ËØæÁ®ã" },
                { english: "degree", chinese: "Â≠¶‰Ωç" }
            ],
            intermediate: [
                { english: "academic", chinese: "Â≠¶ÊúØÁöÑ" },
                { english: "research", chinese: "Á†îÁ©∂" },
                { english: "presentation", chinese: "ÊºîËÆ≤" },
                { english: "seminar", chinese: "Á†îËÆ®‰ºö" },
                { english: "thesis", chinese: "ËÆ∫Êñá" },
                { english: "scholarship", chinese: "Â•ñÂ≠¶Èáë" },
                { english: "discipline", chinese: "Â≠¶Áßë" },
                { english: "curriculum", chinese: "ËØæÁ®ãËÆæÁΩÆ" },
                { english: "assessment", chinese: "ËØÑ‰º∞" },
                { english: "literature", chinese: "ÊñáÁåÆ" }
            ],
            advanced: [
                { english: "methodology", chinese: "ÊñπÊ≥ïËÆ∫" },
                { english: "hypothesis", chinese: "ÂÅáËÆæ" },
                { english: "quantitative", chinese: "ÂÆöÈáèÁöÑ" },
                { english: "qualitative", chinese: "ÂÆöÊÄßÁöÑ" },
                { english: "paradigm", chinese: "ËåÉÂºè" },
                { english: "epistemology", chinese: "ËÆ§ËØÜËÆ∫" },
                { english: "phenomenology", chinese: "Áé∞Ë±°Â≠¶" },
                { english: "ontology", chinese: "Êú¨‰ΩìËÆ∫" },
                { english: "validity", chinese: "ÊúâÊïàÊÄß" },
                { english: "reliability", chinese: "ÂèØÈù†ÊÄß" }
            ]
        };

        // ÂÖ®Â±ÄÂèòÈáè
        let currentDifficulty = null;
        let currentVocabulary = [];
        let currentIndex = 0;
        let score = 0;
        let timeLeft = 30;
        let timerInterval = null;
        let isPaused = false;
        let hintsUsed = 0;
        let skippedWords = 0;
        let currentHintUsed = false;
        let quizResults = [];
        let audioContext = null;

        // DOM ÂÖÉÁ¥†
        const pages = document.querySelectorAll('.page');
        const welcomePage = document.getElementById('welcome-page');
        const quizPage = document.getElementById('quiz-page');
        const resultPage = document.getElementById('result-page');
        const historyPage = document.getElementById('history-page');
        const mistakesPage = document.getElementById('mistakes-page');

        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const startBtn = document.getElementById('start-btn');
        const pronounceBtn = document.getElementById('pronounce-btn');
        const hintBtn = document.getElementById('hint-btn');
        const submitBtn = document.getElementById('submit-btn');
        const skipBtn = document.getElementById('skip-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const restartBtn = document.getElementById('restart-btn');
        const historyBtn = document.getElementById('history-btn');
        const mistakesBtn = document.getElementById('mistakes-btn');
        const backFromHistoryBtn = document.getElementById('back-from-history-btn');
        const backFromMistakesBtn = document.getElementById('back-from-mistakes-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const clearMistakesBtn = document.getElementById('clear-mistakes-btn');
        const downloadMistakesBtn = document.getElementById('download-mistakes-btn');

        const wordInput = document.getElementById('word-input');
        const chineseMeaning = document.getElementById('chinese-meaning');
        const letterCount = document.getElementById('letter-count');
        const feedback = document.getElementById('feedback');
        const hintInfo = document.getElementById('hint-info');
        const timeLeftElement = document.getElementById('time-left');
        const currentScoreElement = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        const finalScoreElement = document.getElementById('final-score');
        const totalWordsElement = document.getElementById('total-words');
        const correctWordsElement = document.getElementById('correct-words');
        const accuracyElement = document.getElementById('accuracy');
        const hintsUsedElement = document.getElementById('hints-used');
        const skippedWordsElement = document.getElementById('skipped-words');
        const mistakeWordsElement = document.getElementById('mistake-words');
        const answerListElement = document.getElementById('answer-list');
        const historyListElement = document.getElementById('history-list');
        const mistakesListElement = document.getElementById('mistakes-list');
        const timerElement = document.querySelector('.timer');

        // ÂàùÂßãÂåñÈ°µÈù¢
        function init() {
            // ÂàùÂßãÂåñÈü≥È¢ë‰∏ä‰∏ãÊñá
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext();
            } catch (e) {
                console.warn('Web Audio API is not supported in this browser');
            }

            // ‰∫ã‰ª∂ÁõëÂê¨
            difficultyButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentDifficulty = btn.dataset.difficulty;
                });
            });

            startBtn.addEventListener('click', startQuiz);
            pronounceBtn.addEventListener('click', pronounceWord);
            hintBtn.addEventListener('click', showHint);
            submitBtn.addEventListener('click', checkAnswer);
            skipBtn.addEventListener('click', skipWord);
            pauseBtn.addEventListener('click', togglePause);
            restartBtn.addEventListener('click', restartQuiz);
            historyBtn.addEventListener('click', showHistory);
            mistakesBtn.addEventListener('click', showMistakes);
            backFromHistoryBtn.addEventListener('click', goToResultPage);
            backFromMistakesBtn.addEventListener('click', goToResultPage);
            clearHistoryBtn.addEventListener('click', clearHistory);
            clearMistakesBtn.addEventListener('click', clearMistakes);
            downloadMistakesBtn.addEventListener('click', downloadMistakes);

            // ÈîÆÁõòÂø´Êç∑ÈîÆ - ‰øÆÂ§çËæìÂÖ•ÈóÆÈ¢ò
            document.addEventListener('keydown', handleKeyPress);

            // Ëá™Âä®ÈÄâÊã©Á¨¨‰∏Ä‰∏™ÈöæÂ∫¶
            if (difficultyButtons.length > 0) {
                difficultyButtons[0].click();
            }

            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
            loadHistory();
            loadMistakes();
        }

        // È°µÈù¢ÂàáÊç¢
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // ÂºÄÂßãÂê¨ÂÜô
        function startQuiz() {
            if (!currentDifficulty) {
                alert('ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÈöæÂ∫¶Á∫ßÂà´');
                return;
            }

            // ÂàùÂßãÂåñËØçÊ±áÂàóË°®
            if (currentDifficulty === 'mixed') {
                currentVocabulary = [
                    ...vocabulary.basic,
                    ...vocabulary.intermediate,
                    ...vocabulary.advanced
                ];
            } else {
                currentVocabulary = [...vocabulary[currentDifficulty]];
            }

            // ÈöèÊú∫ÊéíÂ∫è
            currentVocabulary = shuffleArray(currentVocabulary);

            // ÈáçÁΩÆÁä∂ÊÄÅ
            currentIndex = 0;
            score = 0;
            hintsUsed = 0;
            skippedWords = 0;
            quizResults = [];

            // Êõ¥Êñ∞UI
            currentScoreElement.textContent = score;
            updateProgress();

            // ÊòæÁ§∫Á¨¨‰∏Ä‰∏™ÂçïËØç
            showCurrentWord();

            // ÂºÄÂßãËÆ°Êó∂
            startTimer();

            // ÂàáÊç¢Âà∞Á≠îÈ¢òÈ°µÈù¢
            showPage('quiz-page');

            // ËÅöÁÑ¶ËæìÂÖ•Ê°Ü
            wordInput.focus();
        }

        // ÊòæÁ§∫ÂΩìÂâçÂçïËØç
        function showCurrentWord() {
            if (currentIndex >= currentVocabulary.length) {
                endQuiz();
                return;
            }

            const currentWord = currentVocabulary[currentIndex];
            chineseMeaning.textContent = currentWord.chinese;
            letterCount.textContent = currentWord.english.length;
            wordInput.value = '';
            feedback.textContent = '';
            hintInfo.textContent = '';
            currentHintUsed = false;
            timeLeft = 30;
            timeLeftElement.textContent = timeLeft;
            timerElement.classList.remove('warning', 'danger');

            // ËÅöÁÑ¶ËæìÂÖ•Ê°Ü
            wordInput.focus();
        }

        // ÂºÄÂßãËÆ°Êó∂Âô®
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    timeLeftElement.textContent = timeLeft;

                    // Êó∂Èó¥Ë≠¶Âëä
                    if (timeLeft <= 10) {
                        timerElement.classList.add('warning');
                    }
                    if (timeLeft <= 5) {
                        timerElement.classList.remove('warning');
                        timerElement.classList.add('danger');
                    }

                    if (timeLeft <= 0) {
                        // Êó∂Èó¥Âà∞ÔºåËá™Âä®Ë∑≥Ëøá
                        skipWord();
                    }
                }
            }, 1000);
        }

        // ÊöÇÂÅú/ÁªßÁª≠
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> ÁªßÁª≠';
                timerElement.classList.add('warning');
            } else {
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> ÊöÇÂÅú';
                timerElement.classList.remove('warning');
                // ÊÅ¢Â§çÊó∂Èó¥Ë≠¶ÂëäÁä∂ÊÄÅ
                if (timeLeft <= 10) {
                    timerElement.classList.add('warning');
                }
                if (timeLeft <= 5) {
                    timerElement.classList.remove('warning');
                    timerElement.classList.add('danger');
                }
                // ÊÅ¢Â§çËæìÂÖ•Ê°ÜÁÑ¶ÁÇπ
                wordInput.focus();
            }
        }

        // Ê£ÄÊü•Á≠îÊ°à - ‰ºòÂåñ‰∏∫Á≠âÂæÖÁî®Êà∑Êèê‰∫§ÂêéÂÜçÂèçÈ¶à
        function checkAnswer() {
            // Á°Æ‰øùÊúâËæìÂÖ•ÔºàÈùûÁ©∫Ôºâ
            if (!wordInput.value.trim()) {
                feedback.textContent = "ËØ∑ËæìÂÖ•ÂçïËØçÂêéÂÜçÊèê‰∫§";
                feedback.className = 'feedback incorrect';
                wordInput.focus();
                return;
            }

            const userAnswer = wordInput.value.trim().toLowerCase();
            const currentWord = currentVocabulary[currentIndex];
            const isCorrect = userAnswer === currentWord.english.toLowerCase();

            // ËÆ∞ÂΩïÁªìÊûú
            quizResults.push({
                english: currentWord.english,
                chinese: currentWord.chinese,
                userAnswer: userAnswer,
                isCorrect: isCorrect,
                usedHint: currentHintUsed,
                isSkipped: false
            });

            // ÊòæÁ§∫ÂèçÈ¶à
            if (isCorrect) {
                feedback.textContent = `Ê≠£Á°ÆÔºÅÁ≠îÊ°àÊòØ ${currentWord.english}`;
                feedback.className = 'feedback correct';
                score += 10;
                currentScoreElement.textContent = score;
                playSound('correct');
            } else {
                feedback.textContent = `ÈîôËØØ„ÄÇÊ≠£Á°ÆÁ≠îÊ°àÊòØ ${currentWord.english}`;
                feedback.className = 'feedback incorrect';
                addToMistakes(currentWord);
                playSound('error');
            }

            // Á¶ÅÁî®ËæìÂÖ•ÂíåÊåâÈíÆÔºåÈÅøÂÖçÈáçÂ§çÊìç‰Ωú
            wordInput.disabled = true;
            submitBtn.disabled = true;
            skipBtn.disabled = true;
            hintBtn.disabled = true;
            pronounceBtn.disabled = true;

            // Âª∂ËøüËøõÂÖ•‰∏ã‰∏Ä‰∏™ÂçïËØç
            clearInterval(timerInterval);
            setTimeout(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                wordInput.disabled = false;
                submitBtn.disabled = false;
                skipBtn.disabled = false;
                hintBtn.disabled = false;
                pronounceBtn.disabled = false;
                
                currentIndex++;
                updateProgress();
                showCurrentWord();
                startTimer();
            }, 1500);
        }

        // Ë∑≥ËøáÂçïËØç
        function skipWord() {
            const currentWord = currentVocabulary[currentIndex];
            
            // ËÆ∞ÂΩïÁªìÊûú
            quizResults.push({
                english: currentWord.english,
                chinese: currentWord.chinese,
                userAnswer: '',
                isCorrect: false,
                usedHint: currentHintUsed,
                isSkipped: true
            });

            skippedWords++;
            feedback.textContent = `Â∑≤Ë∑≥Ëøá„ÄÇÊ≠£Á°ÆÁ≠îÊ°àÊòØ ${currentWord.english}`;
            feedback.className = 'feedback';
            addToMistakes(currentWord);

            // Á¶ÅÁî®ËæìÂÖ•ÂíåÊåâÈíÆÔºåÈÅøÂÖçÈáçÂ§çÊìç‰Ωú
            wordInput.disabled = true;
            submitBtn.disabled = true;
            skipBtn.disabled = true;
            hintBtn.disabled = true;
            pronounceBtn.disabled = true;

            // Âª∂ËøüËøõÂÖ•‰∏ã‰∏Ä‰∏™ÂçïËØç
            clearInterval(timerInterval);
            setTimeout(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                wordInput.disabled = false;
                submitBtn.disabled = false;
                skipBtn.disabled = false;
                hintBtn.disabled = false;
                pronounceBtn.disabled = false;
                
                currentIndex++;
                updateProgress();
                showCurrentWord();
                startTimer();
            }, 1500);
        }

        // ÊòæÁ§∫ÊèêÁ§∫
        function showHint() {
            if (currentHintUsed) return;

            const currentWord = currentVocabulary[currentIndex];
            if (currentWord.english.length >= 2) {
                const hint = currentWord.english.substring(0, 2);
                hintInfo.textContent = `ÊèêÁ§∫ÔºöÂçïËØç‰ª• "${hint}" ÂºÄÂ§¥`;
                currentHintUsed = true;
                hintsUsed++;
            }
        }

        // Êõ¥Êñ∞ËøõÂ∫¶Êù°
        function updateProgress() {
            const progress = (currentIndex / currentVocabulary.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // ÁªìÊùüÂê¨ÂÜô
        function endQuiz() {
            clearInterval(timerInterval);

            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const totalWords = quizResults.length;
            const correctWords = quizResults.filter(r => r.isCorrect).length;
            const accuracy = totalWords > 0 ? Math.round((correctWords / totalWords) * 100) : 0;
            const mistakeWords = totalWords - correctWords - skippedWords;

            // Êõ¥Êñ∞ÁªìÊûúÈ°µÈù¢
            finalScoreElement.textContent = score;
            totalWordsElement.textContent = totalWords;
            correctWordsElement.textContent = correctWords;
            accuracyElement.textContent = `${accuracy}%`;
            hintsUsedElement.textContent = hintsUsed;
            skippedWordsElement.textContent = skippedWords;
            mistakeWordsElement.textContent = mistakeWords;

            // ÊòæÁ§∫Á≠îÈ¢òÊÉÖÂÜµ
            answerListElement.innerHTML = '';
            quizResults.forEach(result => {
                const item = document.createElement('div');
                item.className = `answer-item ${result.isCorrect ? 'correct' : 'incorrect'}`;
                
                let statusText = result.isCorrect ? 'Ê≠£Á°Æ' : 
                                 result.isSkipped ? 'Â∑≤Ë∑≥Ëøá' : 'ÈîôËØØ';
                
                item.innerHTML = `
                    <div>
                        <div class="answer-word">${result.english}</div>
                        <div>${result.chinese}</div>
                    </div>
                    <div class="answer-status ${result.isCorrect ? 'correct' : 'incorrect'}">
                        ${statusText} ${result.usedHint ? '<small>(‰ΩøÁî®ÊèêÁ§∫)</small>' : ''}
                    </div>
                `;
                answerListElement.appendChild(item);
            });

            // ‰øùÂ≠òÂéÜÂè≤ËÆ∞ÂΩï
            saveHistory({
                date: new Date().toISOString(),
                difficulty: currentDifficulty,
                score: score,
                totalWords: totalWords,
                correctWords: correctWords,
                accuracy: accuracy,
                hintsUsed: hintsUsed,
                skippedWords: skippedWords
            });

            // ÂàáÊç¢Âà∞ÁªìÊûúÈ°µÈù¢
            showPage('result-page');
        }

        // ÈáçÊñ∞ÂºÄÂßã
        function restartQuiz() {
            showPage('welcome-page');
        }

        // ÊòæÁ§∫ÂéÜÂè≤ËÆ∞ÂΩï
        function showHistory() {
            loadHistory();
            showPage('history-page');
        }

        // ÊòæÁ§∫ÈîôÈ¢òÊú¨
        function showMistakes() {
            loadMistakes();
            showPage('mistakes-page');
        }

        // ËøîÂõûÁªìÊûúÈ°µÈù¢
        function goToResultPage() {
            showPage('result-page');
        }

        // Â§ÑÁêÜÈîÆÁõò‰∫ã‰ª∂ - ‰øÆÂ§çËæìÂÖ•ÈóÆÈ¢ò
        function handleKeyPress(e) {
            // ËæìÂÖ•Ê°ÜËÅöÁÑ¶Êó∂ÔºåÂè™Â§ÑÁêÜÂõûËΩ¶ÈîÆÔºàÊèê‰∫§Ôºâ
            if (document.activeElement === wordInput) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkAnswer();
                }
                // ÂÖ∂‰ªñÊåâÈîÆÂÖÅËÆ∏Ê≠£Â∏∏ËæìÂÖ•
                return;
            }

            // ËæìÂÖ•Ê°ÜÊú™ËÅöÁÑ¶Êó∂Â§ÑÁêÜÂÖ∂‰ªñÂø´Êç∑ÈîÆ
            if (quizPage.classList.contains('active')) {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePause();
                        break;
                    case 'h':
                    case 'H':
                        e.preventDefault();
                        showHint();
                        break;
                    case 's':
                    case 'S':
                        e.preventDefault();
                        skipWord();
                        break;
                    case 'Enter':
                        e.preventDefault();
                        checkAnswer();
                        break;
                }
            }
        }

        // ÂçïËØçÂèëÈü≥ - ‰øÆÂ§çÂèëÈü≥ÈóÆÈ¢ò
        function pronounceWord() {
            // Á°Æ‰øùÂΩìÂâçÊúâÂçïËØç
            if (currentIndex >= currentVocabulary.length) return;
            
            const currentWord = currentVocabulary[currentIndex];
            
            // ÂÅúÊ≠¢‰ªª‰ΩïÊ≠£Âú®ËøõË°åÁöÑÂèëÈü≥
            window.speechSynthesis.cancel();
            
            // ÂàõÂª∫Êñ∞ÁöÑÂèëÈü≥ÂÆû‰æã
            const utterance = new SpeechSynthesisUtterance(currentWord.english);
            utterance.lang = 'en-US';
            utterance.rate = 0.9; // Á®çÊÖ¢‰∏ÄÁÇπÔºå‰æø‰∫éÂê¨Ê∏Ö
            
            // Á°Æ‰øùÂèëÈü≥APIÂáÜÂ§áÂ∞±Áª™
            if (window.speechSynthesis.pending) {
                window.speechSynthesis.cancel();
            }
            
            // ÂèëÈü≥
            window.speechSynthesis.speak(utterance);
            
            // ËßÜËßâÂèçÈ¶à
            pronounceBtn.classList.add('btn-success');
            setTimeout(() => {
                pronounceBtn.classList.remove('btn-success');
            }, 300);
        }

        // Êí≠ÊîæÈü≥Êïà
        function playSound(type) {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // ËÆæÁΩÆ‰∏çÂêåÁöÑÈü≥Ë∞É
            if (type === 'correct') {
                // ‰∏äÂçáÈü≥Ë∞É C-E-G
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime); // C4
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); // E4
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime + 0.2); // G4
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'error') {
                // ‰∏ãÈôçÈü≥Ë∞É
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); // G4
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); // E4
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.2); // C4
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }

        // Êï∞ÁªÑÈöèÊú∫ÊéíÂ∫è
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Êú¨Âú∞Â≠òÂÇ® - ÂéÜÂè≤ËÆ∞ÂΩï
        function saveHistory(historyItem) {
            let history = JSON.parse(localStorage.getItem('dictationHistory') || '[]');
            history.unshift(historyItem); // Ê∑ªÂä†Âà∞ÂºÄÂ§¥
            
            // Âè™‰øùÁïôÊúÄËøë20Êù°ËÆ∞ÂΩï
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            localStorage.setItem('dictationHistory', JSON.stringify(history));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('dictationHistory') || '[]');
            historyListElement.innerHTML = '';
            
            if (history.length === 0) {
                historyListElement.innerHTML = '<div style="text-align: center; padding: 20px;">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>';
                return;
            }
            
            history.forEach(item => {
                const date = new Date(item.date);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const difficultyNames = {
                    'basic': 'Âü∫Á°Ä',
                    'intermediate': '‰∏≠Á∫ß',
                    'advanced': 'È´òÁ∫ß',
                    'mixed': 'Ê∑∑Âêà'
                };
                
                const itemElement = document.createElement('div');
                itemElement.className = 'history-item';
                itemElement.innerHTML = `
                    <div>
                        <div>${formattedDate} ¬∑ ${difficultyNames[item.difficulty]}</div>
                        <div>Ê≠£Á°ÆÁéá: ${item.accuracy}%</div>
                    </div>
                    <div style="font-weight: bold; color: var(--primary-1);">${item.score} ÂàÜ</div>
                `;
                historyListElement.appendChild(itemElement);
            });
        }

        function clearHistory() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                localStorage.removeItem('dictationHistory');
                loadHistory();
            }
        }

        // Êú¨Âú∞Â≠òÂÇ® - ÈîôÈ¢òÊú¨
        function addToMistakes(word) {
            let mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÔºåÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†
            const exists = mistakes.some(m => m.english.toLowerCase() === word.english.toLowerCase());
            if (!exists) {
                mistakes.push({
                    english: word.english,
                    chinese: word.chinese,
                    addedDate: new Date().toISOString()
                });
                localStorage.setItem('dictationMistakes', JSON.stringify(mistakes));
            }
        }

        function loadMistakes() {
            const mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            mistakesListElement.innerHTML = '';
            
            if (mistakes.length === 0) {
                mistakesListElement.innerHTML = '<div style="text-align: center; padding: 20px;">ÊöÇÊó†ÈîôÈ¢òËÆ∞ÂΩï</div>';
                return;
            }
            
            // ÊåâÊ∑ªÂä†Êó∂Èó¥ÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
            mistakes.sort((a, b) => new Date(b.addedDate) - new Date(a.addedDate));
            
            mistakes.forEach(mistake => {
                const itemElement = document.createElement('div');
                itemElement.className = 'mistake-item';
                itemElement.innerHTML = `
                    <div class="mistake-word">${mistake.english}</div>
                    <div class="mistake-meaning">${mistake.chinese}</div>
                    <button class="btn btn-sm btn-outline pronounce-mistake" data-word="${mistake.english}">
                        <i class="fas fa-volume-up"></i>
                    </button>
                `;
                mistakesListElement.appendChild(itemElement);
            });
            
            // ‰∏∫ÈîôÈ¢òÊ∑ªÂä†ÂèëÈü≥ÂäüËÉΩ
            document.querySelectorAll('.pronounce-mistake').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const word = e.currentTarget.dataset.word;
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                });
            });
        }

        function clearMistakes() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÈîôÈ¢òËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                localStorage.removeItem('dictationMistakes');
                loadMistakes();
            }
        }

        // ‰∏ãËΩΩÈîôÈ¢òÊú¨ - Á°Æ‰øù‰ΩøÁî®UTF-8ÁºñÁ†ÅÂπ∂Ê∑ªÂä†BOMÂ§¥Ëß£ÂÜ≥‰∏≠Êñá‰π±Á†Å
        function downloadMistakes() {
            const mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            
            if (mistakes.length === 0) {
                alert('ÊöÇÊó†ÈîôÈ¢òÂèØ‰∏ãËΩΩ');
                return;
            }
            
            // ÁîüÊàêCSVÂÜÖÂÆπÔºåÊ∑ªÂä†UTF-8 BOMÂ§¥Ëß£ÂÜ≥‰∏≠Êñá‰π±Á†ÅÈóÆÈ¢ò
            // \ufeffÊòØUTF-8 BOMÂ§¥ÔºåÂ∏ÆÂä©ExcelÊ≠£Á°ÆËØÜÂà´ÁºñÁ†Å
            let csvContent = "\ufeffËã±ÊñáÂçïËØç,‰∏≠ÊñáÈáä‰πâ\n";
            mistakes.forEach(mistake => {
                // Â§ÑÁêÜÂåÖÂê´ÈÄóÂè∑ÊàñÂºïÂè∑ÁöÑÂÜÖÂÆπ
                const english = `"${mistake.english.replace(/"/g, '""')}"`;
                const chinese = `"${mistake.chinese.replace(/"/g, '""')}"`;
                csvContent += `${english},${chinese}\n`;
            });
            
            // ÂàõÂª∫BlobÊó∂ÊòéÁ°ÆÊåáÂÆöUTF-8ÁºñÁ†Å
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `Ëã±ËØ≠Âê¨ÂÜôÈîôÈ¢òÊú¨_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // ÈáäÊîæURLÂØπË±°
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    