<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è¯æ±‡å¬å†™è®­ç»ƒ ğŸªğŸ“š</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-1: #6366f1;
            --primary-2: #8b5cf6;
            --secondary: #c4b5fd;
            --light: #f5f3ff;
            --dark: #374151;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --white: #ffffff;
            --shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.1), 0 8px 10px -6px rgba(99, 102, 241, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */
        .page {
            display: none;
            animation: fadeIn 0.5s ease forwards;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ ‡é¢˜æ ·å¼ */
        .app-title {
            text-align: center;
            margin: 30px 0;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 2.5rem;
            position: relative;
        }

        .app-title::after {
            content: 'ğŸª';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
        }

        .app-subtitle {
            text-align: center;
            color: var(--dark);
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            color: var(--white);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.2), 0 4px 6px -2px rgba(99, 102, 241, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-1);
            color: var(--primary-1);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-error {
            background: var(--error);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* éš¾åº¦é€‰æ‹© */
        .difficulty-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            flex: 1;
            min-width: 120px;
            padding: 20px 10px;
            text-align: center;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            background: var(--white);
            box-shadow: var(--shadow);
        }

        .difficulty-btn:hover {
            transform: translateY(-5px);
        }

        .difficulty-btn.selected {
            border-color: var(--primary-1);
            background: rgba(99, 102, 241, 0.05);
        }

        .difficulty-btn i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-1);
        }

        /* ç­”é¢˜é¡µé¢æ ·å¼ */
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: var(--secondary);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-1), var(--primary-2));
            width: 0%;
            transition: width 0.3s ease;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer.warning {
            color: var(--warning);
        }

        .timer.danger {
            color: var(--error);
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }

        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-1);
        }

        .chinese-meaning {
            font-size: 1.8rem;
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: var(--light);
            border-radius: 12px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-container {
            margin: 30px 0;
        }

        .word-input {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            transition: var(--transition);
            text-align: center;
        }

        .word-input:focus {
            outline: none;
            border-color: var(--primary-1);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            min-height: 40px;
        }

        .feedback.correct {
            color: var(--success);
            animation: bounce 0.5s ease;
        }

        .feedback.incorrect {
            color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .hint-info {
            text-align: center;
            color: var(--dark);
            margin: 15px 0;
            font-style: italic;
        }

        .letter-count {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-1);
            font-weight: 500;
        }

        /* ç»“æœé¡µé¢æ ·å¼ */
        .result-summary {
            text-align: center;
            margin: 30px 0;
        }

        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-1);
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background-color: var(--light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-1);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--dark);
            font-size: 0.9rem;
        }

        .history-list, .mistakes-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .history-item, .mistake-item {
            padding: 12px;
            border-bottom: 1px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child, .mistake-item:last-child {
            border-bottom: none;
        }

        .mistake-word {
            font-weight: bold;
            color: var(--primary-1);
        }

        .mistake-meaning {
            color: var(--dark);
        }

        .answer-list {
            margin: 20px 0;
        }

        .answer-item {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .answer-item.correct {
            background-color: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
        }

        .answer-item.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
        }

        .answer-word {
            font-weight: 500;
        }

        .answer-status {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .answer-status.correct {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .answer-status.incorrect {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        /* æµ®åŠ¨å…ƒç´  */
        .floating {
            position: absolute;
            pointer-events: none;
            opacity: 0.6;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* é”®ç›˜å¿«æ·é”®æç¤º */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            font-size: 0.8rem;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .key {
            background-color: var(--light);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .app-title {
                font-size: 2rem;
            }

            .chinese-meaning {
                font-size: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .keyboard-shortcuts {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .app-title {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .final-score {
                font-size: 2.5rem;
            }
        }

        /* æ°´æ³¢çº¹æ•ˆæœ */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple:after {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.5s, opacity 0.8s;
        }

        .ripple:active:after {
            transform: scale(0, 0);
            opacity: 0.3;
            transition: 0s;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æµ®åŠ¨è£…é¥°å…ƒç´  -->
        <div class="floating" style="top: 10%; left: 5%; font-size: 2rem;">ğŸ“š</div>
        <div class="floating" style="top: 20%; right: 8%; font-size: 1.5rem; animation-delay: 1s;">âœ¨</div>
        <div class="floating" style="top: 60%; left: 3%; font-size: 1.8rem; animation-delay: 2s;">ğŸ¯</div>
        <div class="floating" style="top: 70%; right: 5%; font-size: 1.6rem; animation-delay: 3s;">ğŸ“–</div>

        <h1 class="app-title">è‹±è¯­è¯æ±‡å¬å†™è®­ç»ƒ</h1>
        <p class="app-subtitle">æå‡ä½ çš„è¯æ±‡é‡ï¼Œè½»æ¾åº”å¯¹å­¦æœ¯æŒ‘æˆ˜ âœ¨</p>

        <!-- æ¬¢è¿é¡µé¢ -->
        <div id="welcome-page" class="page active">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary-1);">é€‰æ‹©è¯æ±‡éš¾åº¦</h2>
                <p style="text-align: center; margin-bottom: 30px;">è¯·é€‰æ‹©é€‚åˆä½ çš„è¯æ±‡éš¾åº¦çº§åˆ«å¼€å§‹è®­ç»ƒ</p>
                
                <div class="difficulty-selection">
                    <div class="difficulty-btn" data-difficulty="basic">
                        <i class="fas fa-seedling"></i>
                        <div>åŸºç¡€è¯æ±‡</div>
                        <small>æ•™è‚²ç›¸å…³åŸºç¡€è¯</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="intermediate">
                        <i class="fas fa-tree"></i>
                        <div>ä¸­çº§è¯æ±‡</div>
                        <small>å­¦æœ¯ç›¸å…³ä¸­çº§è¯</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="advanced">
                        <i class="fas fa-mountain"></i>
                        <div>é«˜çº§è¯æ±‡</div>
                        <small>å­¦æœ¯ä¸“ä¸šé«˜çº§è¯</small>
                    </div>
                    <div class="difficulty-btn" data-difficulty="mixed">
                        <i class="fas fa-random"></i>
                        <div>æ··åˆæ¨¡å¼</div>
                        <small>éšæœºæ··åˆæ‰€æœ‰éš¾åº¦</small>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button id="start-btn" class="btn ripple">
                        <i class="fas fa-play"></i> å¼€å§‹å¬å†™
                    </button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px; color: var(--primary-1);">ğŸ“ è®­ç»ƒè¯´æ˜</h3>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>ç³»ç»Ÿå°†æ˜¾ç¤ºä¸­æ–‡é‡Šä¹‰ï¼Œè¯·è¾“å…¥å¯¹åº”çš„è‹±æ–‡å•è¯</li>
                    <li>æ¯ä¸ªå•è¯æœ‰30ç§’çš„ç­”é¢˜æ—¶é—´</li>
                    <li>å¯ä½¿ç”¨æç¤ºåŠŸèƒ½è·å–å‰ä¸¤ä¸ªå­—æ¯çš„æç¤º</li>
                    <li>å®Œæˆæ‰€æœ‰å•è¯åå°†æ˜¾ç¤ºè¯¦ç»†çš„ç»Ÿè®¡ç»“æœ</li>
                    <li>é”™è¯¯çš„å•è¯å°†è‡ªåŠ¨åŠ å…¥é”™é¢˜æœ¬</li>
                </ul>
            </div>
        </div>

        <!-- ç­”é¢˜é¡µé¢ -->
        <div id="quiz-page" class="page">
            <div class="card">
                <div class="progress-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>

                <div class="top-bar">
                    <div class="timer">
                        <i class="far fa-clock"></i>
                        <span id="time-left">30</span> ç§’
                    </div>
                    <div class="score-display">
                        å¾—åˆ†: <span id="current-score">0</span>
                    </div>
                </div>

                <div class="chinese-meaning" id="chinese-meaning">
                    ç­‰å¾…å¼€å§‹...
                </div>

                <div class="letter-count">
                    å•è¯é•¿åº¦: <span id="letter-count">0</span> ä¸ªå­—æ¯
                </div>

                <div class="input-container">
                    <input type="text" id="word-input" class="word-input" placeholder="è¯·è¾“å…¥è‹±æ–‡å•è¯..." autocomplete="off">
                </div>

                <div class="feedback" id="feedback"></div>

                <div class="hint-info" id="hint-info">
                    <!-- æç¤ºä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>

                <div class="action-buttons">
                    <button id="pronounce-btn" class="btn btn-outline ripple">
                        <i class="fas fa-volume-up"></i> å‘éŸ³
                    </button>
                    <button id="hint-btn" class="btn btn-warning ripple">
                        <i class="fas fa-lightbulb"></i> æç¤º
                    </button>
                    <button id="submit-btn" class="btn btn-success ripple">
                        <i class="fas fa-check"></i> æäº¤
                    </button>
                    <button id="skip-btn" class="btn btn-error ripple">
                        <i class="fas fa-forward"></i> è·³è¿‡
                    </button>
                </div>

                <div style="text-align: center;">
                    <button id="pause-btn" class="btn btn-sm ripple">
                        <i class="fas fa-pause"></i> æš‚åœ
                    </button>
                </div>
            </div>
        </div>

        <!-- ç»“æœé¡µé¢ -->
        <div id="result-page" class="page">
            <div class="card">
                <div class="result-summary">
                    <h2>è®­ç»ƒå®Œæˆï¼ğŸ‰</h2>
                    <div class="final-score" id="final-score">0</div>
                    <p>æ­å–œä½ å®Œæˆäº†æœ¬æ¬¡è¯æ±‡å¬å†™è®­ç»ƒ</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-words">0</div>
                        <div class="stat-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="correct-words">0</div>
                        <div class="stat-label">æ­£ç¡®æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">æ­£ç¡®ç‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="hints-used">0</div>
                        <div class="stat-label">æç¤ºä½¿ç”¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="skipped-words">0</div>
                        <div class="stat-label">è·³è¿‡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="mistake-words">0</div>
                        <div class="stat-label">é”™è¯¯æ•°</div>
                    </div>
                </div>

                <h3 style="margin: 30px 0 15px; color: var(--primary-1);">ç­”é¢˜æƒ…å†µ</h3>
                <div class="answer-list" id="answer-list">
                    <!-- ç­”é¢˜æƒ…å†µå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                    <button id="restart-btn" class="btn ripple">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                    <button id="history-btn" class="btn btn-outline ripple">
                        <i class="fas fa-history"></i> æŸ¥çœ‹å†å²
                    </button>
                    <button id="mistakes-btn" class="btn btn-outline ripple">
                        <i class="fas fa-exclamation-circle"></i> é”™é¢˜æœ¬
                    </button>
                </div>
            </div>
        </div>

        <!-- å†å²è®°å½•é¡µé¢ -->
        <div id="history-page" class="page">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--primary-1);">è®­ç»ƒå†å²è®°å½• ğŸ“œ</h2>
                    <button id="back-from-history-btn" class="btn btn-sm ripple">
                        <i class="fas fa-arrow-left"></i> è¿”å›
                    </button>
                </div>

                <div class="history-list" id="history-list">
                    <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="clear-history-btn" class="btn btn-error btn-sm ripple">
                        <i class="fas fa-trash"></i> æ¸…ç©ºå†å²è®°å½•
                    </button>
                </div>
            </div>
        </div>

        <!-- é”™é¢˜æœ¬é¡µé¢ -->
        <div id="mistakes-page" class="page">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--primary-1);">é”™é¢˜æœ¬ âŒ</h2>
                    <button id="back-from-mistakes-btn" class="btn btn-sm ripple">
                        <i class="fas fa-arrow-left"></i> è¿”å›
                    </button>
                </div>

                <p style="margin-bottom: 20px;">è¿™é‡Œæ”¶é›†äº†ä½ æ‰€æœ‰ç­”é”™çš„å•è¯ï¼Œå¯ä»¥ä¸‹è½½è¿›è¡Œé’ˆå¯¹æ€§å¤ä¹ ã€‚</p>

                <div class="mistakes-list" id="mistakes-list">
                    <!-- é”™é¢˜å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                    <button id="download-mistakes-btn" class="btn ripple">
                        <i class="fas fa-download"></i> ä¸‹è½½é”™é¢˜æœ¬ (CSV)
                    </button>
                    <button id="clear-mistakes-btn" class="btn btn-error btn-sm ripple">
                        <i class="fas fa-trash"></i> æ¸…ç©ºé”™é¢˜æœ¬
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- é”®ç›˜å¿«æ·é”®æç¤º -->
    <div class="keyboard-shortcuts" id="keyboard-shortcuts">
        <div><span class="key">ç©ºæ ¼</span> æš‚åœ/ç»§ç»­</div>
        <div><span class="key">å›è½¦</span> æäº¤</div>
        <div><span class="key">H</span> æç¤º</div>
        <div><span class="key">S</span> è·³è¿‡</div>
    </div>

    <script>
        // è¯æ±‡åº“
        const vocabulary = {
            basic: [
                { english: "student", chinese: "å­¦ç”Ÿ" },
                { english: "teacher", chinese: "æ•™å¸ˆ" },
                { english: "classroom", chinese: "æ•™å®¤" },
                { english: "book", chinese: "ä¹¦" },
                { english: "exam", chinese: "è€ƒè¯•" },
                { english: "homework", chinese: "ä½œä¸š" },
                { english: "library", chinese: "å›¾ä¹¦é¦†" },
                { english: "university", chinese: "å¤§å­¦" },
                { english: "course", chinese: "è¯¾ç¨‹" },
                { english: "degree", chinese: "å­¦ä½" }
            ],
            intermediate: [
                { english: "academic", chinese: "å­¦æœ¯çš„" },
                { english: "research", chinese: "ç ”ç©¶" },
                { english: "presentation", chinese: "æ¼”è®²" },
                { english: "seminar", chinese: "ç ”è®¨ä¼š" },
                { english: "thesis", chinese: "è®ºæ–‡" },
                { english: "scholarship", chinese: "å¥–å­¦é‡‘" },
                { english: "discipline", chinese: "å­¦ç§‘" },
                { english: "curriculum", chinese: "è¯¾ç¨‹è®¾ç½®" },
                { english: "assessment", chinese: "è¯„ä¼°" },
                { english: "literature", chinese: "æ–‡çŒ®" }
            ],
            advanced: [
                { english: "methodology", chinese: "æ–¹æ³•è®º" },
                { english: "hypothesis", chinese: "å‡è®¾" },
                { english: "quantitative", chinese: "å®šé‡çš„" },
                { english: "qualitative", chinese: "å®šæ€§çš„" },
                { english: "paradigm", chinese: "èŒƒå¼" },
                { english: "epistemology", chinese: "è®¤è¯†è®º" },
                { english: "phenomenology", chinese: "ç°è±¡å­¦" },
                { english: "ontology", chinese: "æœ¬ä½“è®º" },
                { english: "validity", chinese: "æœ‰æ•ˆæ€§" },
                { english: "reliability", chinese: "å¯é æ€§" }
            ]
        };

        // å…¨å±€å˜é‡
        let currentDifficulty = null;
        let currentVocabulary = [];
        let currentIndex = 0;
        let score = 0;
        let timeLeft = 30;
        let timerInterval = null;
        let isPaused = false;
        let hintsUsed = 0;
        let skippedWords = 0;
        let currentHintUsed = false;
        let quizResults = [];
        let audioContext = null;

        // DOM å…ƒç´ 
        const pages = document.querySelectorAll('.page');
        const welcomePage = document.getElementById('welcome-page');
        const quizPage = document.getElementById('quiz-page');
        const resultPage = document.getElementById('result-page');
        const historyPage = document.getElementById('history-page');
        const mistakesPage = document.getElementById('mistakes-page');

        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const startBtn = document.getElementById('start-btn');
        const pronounceBtn = document.getElementById('pronounce-btn');
        const hintBtn = document.getElementById('hint-btn');
        const submitBtn = document.getElementById('submit-btn');
        const skipBtn = document.getElementById('skip-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const restartBtn = document.getElementById('restart-btn');
        const historyBtn = document.getElementById('history-btn');
        const mistakesBtn = document.getElementById('mistakes-btn');
        const backFromHistoryBtn = document.getElementById('back-from-history-btn');
        const backFromMistakesBtn = document.getElementById('back-from-mistakes-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const clearMistakesBtn = document.getElementById('clear-mistakes-btn');
        const downloadMistakesBtn = document.getElementById('download-mistakes-btn');

        const wordInput = document.getElementById('word-input');
        const chineseMeaning = document.getElementById('chinese-meaning');
        const letterCount = document.getElementById('letter-count');
        const feedback = document.getElementById('feedback');
        const hintInfo = document.getElementById('hint-info');
        const timeLeftElement = document.getElementById('time-left');
        const currentScoreElement = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        const finalScoreElement = document.getElementById('final-score');
        const totalWordsElement = document.getElementById('total-words');
        const correctWordsElement = document.getElementById('correct-words');
        const accuracyElement = document.getElementById('accuracy');
        const hintsUsedElement = document.getElementById('hints-used');
        const skippedWordsElement = document.getElementById('skipped-words');
        const mistakeWordsElement = document.getElementById('mistake-words');
        const answerListElement = document.getElementById('answer-list');
        const historyListElement = document.getElementById('history-list');
        const mistakesListElement = document.getElementById('mistakes-list');
        const timerElement = document.querySelector('.timer');

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext();
            } catch (e) {
                console.warn('Web Audio API is not supported in this browser');
            }

            // äº‹ä»¶ç›‘å¬
            difficultyButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentDifficulty = btn.dataset.difficulty;
                });
            });

            startBtn.addEventListener('click', startQuiz);
            pronounceBtn.addEventListener('click', pronounceWord);
            hintBtn.addEventListener('click', showHint);
            submitBtn.addEventListener('click', checkAnswer);
            skipBtn.addEventListener('click', skipWord);
            pauseBtn.addEventListener('click', togglePause);
            restartBtn.addEventListener('click', restartQuiz);
            historyBtn.addEventListener('click', showHistory);
            mistakesBtn.addEventListener('click', showMistakes);
            backFromHistoryBtn.addEventListener('click', goToResultPage);
            backFromMistakesBtn.addEventListener('click', goToResultPage);
            clearHistoryBtn.addEventListener('click', clearHistory);
            clearMistakesBtn.addEventListener('click', clearMistakes);
            downloadMistakesBtn.addEventListener('click', downloadMistakes);

            // é”®ç›˜å¿«æ·é”® - ä¿®å¤è¾“å…¥é—®é¢˜
            document.addEventListener('keydown', handleKeyPress);

            // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªéš¾åº¦
            if (difficultyButtons.length > 0) {
                difficultyButtons[0].click();
            }

            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadHistory();
            loadMistakes();
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // å¼€å§‹å¬å†™
        function startQuiz() {
            if (!currentDifficulty) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªéš¾åº¦çº§åˆ«');
                return;
            }

            // åˆå§‹åŒ–è¯æ±‡åˆ—è¡¨
            if (currentDifficulty === 'mixed') {
                currentVocabulary = [
                    ...vocabulary.basic,
                    ...vocabulary.intermediate,
                    ...vocabulary.advanced
                ];
            } else {
                currentVocabulary = [...vocabulary[currentDifficulty]];
            }

            // éšæœºæ’åº
            currentVocabulary = shuffleArray(currentVocabulary);

            // é‡ç½®çŠ¶æ€
            currentIndex = 0;
            score = 0;
            hintsUsed = 0;
            skippedWords = 0;
            quizResults = [];

            // æ›´æ–°UI
            currentScoreElement.textContent = score;
            updateProgress();

            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªå•è¯
            showCurrentWord();

            // å¼€å§‹è®¡æ—¶
            startTimer();

            // åˆ‡æ¢åˆ°ç­”é¢˜é¡µé¢
            showPage('quiz-page');

            // èšç„¦è¾“å…¥æ¡†
            wordInput.focus();
        }

        // æ˜¾ç¤ºå½“å‰å•è¯
        function showCurrentWord() {
            if (currentIndex >= currentVocabulary.length) {
                endQuiz();
                return;
            }

            const currentWord = currentVocabulary[currentIndex];
            chineseMeaning.textContent = currentWord.chinese;
            letterCount.textContent = currentWord.english.length;
            wordInput.value = '';
            feedback.textContent = '';
            hintInfo.textContent = '';
            currentHintUsed = false;
            timeLeft = 30;
            timeLeftElement.textContent = timeLeft;
            timerElement.classList.remove('warning', 'danger');

            // èšç„¦è¾“å…¥æ¡†
            wordInput.focus();
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    timeLeftElement.textContent = timeLeft;

                    // æ—¶é—´è­¦å‘Š
                    if (timeLeft <= 10) {
                        timerElement.classList.add('warning');
                    }
                    if (timeLeft <= 5) {
                        timerElement.classList.remove('warning');
                        timerElement.classList.add('danger');
                    }

                    if (timeLeft <= 0) {
                        // æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨è·³è¿‡
                        skipWord();
                    }
                }
            }, 1000);
        }

        // æš‚åœ/ç»§ç»­
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> ç»§ç»­';
                timerElement.classList.add('warning');
            } else {
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                timerElement.classList.remove('warning');
                // æ¢å¤æ—¶é—´è­¦å‘ŠçŠ¶æ€
                if (timeLeft <= 10) {
                    timerElement.classList.add('warning');
                }
                if (timeLeft <= 5) {
                    timerElement.classList.remove('warning');
                    timerElement.classList.add('danger');
                }
                // æ¢å¤è¾“å…¥æ¡†ç„¦ç‚¹
                wordInput.focus();
            }
        }

        // æ£€æŸ¥ç­”æ¡ˆ - ä¼˜åŒ–ä¸ºç­‰å¾…ç”¨æˆ·æäº¤åå†åé¦ˆ
        function checkAnswer() {
            // ç¡®ä¿æœ‰è¾“å…¥ï¼ˆéç©ºï¼‰
            if (!wordInput.value.trim()) {
                feedback.textContent = "è¯·è¾“å…¥å•è¯åå†æäº¤";
                feedback.className = 'feedback incorrect';
                wordInput.focus();
                return;
            }

            const userAnswer = wordInput.value.trim().toLowerCase();
            const currentWord = currentVocabulary[currentIndex];
            const isCorrect = userAnswer === currentWord.english.toLowerCase();

            // è®°å½•ç»“æœ
            quizResults.push({
                english: currentWord.english,
                chinese: currentWord.chinese,
                userAnswer: userAnswer,
                isCorrect: isCorrect,
                usedHint: currentHintUsed,
                isSkipped: false
            });

            // æ˜¾ç¤ºåé¦ˆ
            if (isCorrect) {
                feedback.textContent = `æ­£ç¡®ï¼ç­”æ¡ˆæ˜¯ ${currentWord.english}`;
                feedback.className = 'feedback correct';
                score += 10;
                currentScoreElement.textContent = score;
                playSound('correct');
            } else {
                feedback.textContent = `é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ ${currentWord.english}`;
                feedback.className = 'feedback incorrect';
                addToMistakes(currentWord);
                playSound('error');
            }

            // ç¦ç”¨è¾“å…¥å’ŒæŒ‰é’®ï¼Œé¿å…é‡å¤æ“ä½œ
            wordInput.disabled = true;
            submitBtn.disabled = true;
            skipBtn.disabled = true;
            hintBtn.disabled = true;
            pronounceBtn.disabled = true;

            // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
            clearInterval(timerInterval);
            setTimeout(() => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                wordInput.disabled = false;
                submitBtn.disabled = false;
                skipBtn.disabled = false;
                hintBtn.disabled = false;
                pronounceBtn.disabled = false;
                
                currentIndex++;
                updateProgress();
                showCurrentWord();
                startTimer();
            }, 1500);
        }

        // è·³è¿‡å•è¯
        function skipWord() {
            const currentWord = currentVocabulary[currentIndex];
            
            // è®°å½•ç»“æœ
            quizResults.push({
                english: currentWord.english,
                chinese: currentWord.chinese,
                userAnswer: '',
                isCorrect: false,
                usedHint: currentHintUsed,
                isSkipped: true
            });

            skippedWords++;
            feedback.textContent = `å·²è·³è¿‡ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ ${currentWord.english}`;
            feedback.className = 'feedback';
            addToMistakes(currentWord);

            // ç¦ç”¨è¾“å…¥å’ŒæŒ‰é’®ï¼Œé¿å…é‡å¤æ“ä½œ
            wordInput.disabled = true;
            submitBtn.disabled = true;
            skipBtn.disabled = true;
            hintBtn.disabled = true;
            pronounceBtn.disabled = true;

            // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
            clearInterval(timerInterval);
            setTimeout(() => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                wordInput.disabled = false;
                submitBtn.disabled = false;
                skipBtn.disabled = false;
                hintBtn.disabled = false;
                pronounceBtn.disabled = false;
                
                currentIndex++;
                updateProgress();
                showCurrentWord();
                startTimer();
            }, 1500);
        }

        // æ˜¾ç¤ºæç¤º
        function showHint() {
            if (currentHintUsed) return;

            const currentWord = currentVocabulary[currentIndex];
            if (currentWord.english.length >= 2) {
                const hint = currentWord.english.substring(0, 2);
                hintInfo.textContent = `æç¤ºï¼šå•è¯ä»¥ "${hint}" å¼€å¤´`;
                currentHintUsed = true;
                hintsUsed++;
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = (currentIndex / currentVocabulary.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // ç»“æŸå¬å†™
        function endQuiz() {
            clearInterval(timerInterval);

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const totalWords = quizResults.length;
            const correctWords = quizResults.filter(r => r.isCorrect).length;
            const accuracy = totalWords > 0 ? Math.round((correctWords / totalWords) * 100) : 0;
            const mistakeWords = totalWords - correctWords - skippedWords;

            // æ›´æ–°ç»“æœé¡µé¢
            finalScoreElement.textContent = score;
            totalWordsElement.textContent = totalWords;
            correctWordsElement.textContent = correctWords;
            accuracyElement.textContent = `${accuracy}%`;
            hintsUsedElement.textContent = hintsUsed;
            skippedWordsElement.textContent = skippedWords;
            mistakeWordsElement.textContent = mistakeWords;

            // æ˜¾ç¤ºç­”é¢˜æƒ…å†µ
            answerListElement.innerHTML = '';
            quizResults.forEach(result => {
                const item = document.createElement('div');
                item.className = `answer-item ${result.isCorrect ? 'correct' : 'incorrect'}`;
                
                let statusText = result.isCorrect ? 'æ­£ç¡®' : 
                                 result.isSkipped ? 'å·²è·³è¿‡' : 'é”™è¯¯';
                
                item.innerHTML = `
                    <div>
                        <div class="answer-word">${result.english}</div>
                        <div>${result.chinese}</div>
                    </div>
                    <div class="answer-status ${result.isCorrect ? 'correct' : 'incorrect'}">
                        ${statusText} ${result.usedHint ? '<small>(ä½¿ç”¨æç¤º)</small>' : ''}
                    </div>
                `;
                answerListElement.appendChild(item);
            });

            // ä¿å­˜å†å²è®°å½•
            saveHistory({
                date: new Date().toISOString(),
                difficulty: currentDifficulty,
                score: score,
                totalWords: totalWords,
                correctWords: correctWords,
                accuracy: accuracy,
                hintsUsed: hintsUsed,
                skippedWords: skippedWords
            });

            // åˆ‡æ¢åˆ°ç»“æœé¡µé¢
            showPage('result-page');
        }

        // é‡æ–°å¼€å§‹
        function restartQuiz() {
            showPage('welcome-page');
        }

        // æ˜¾ç¤ºå†å²è®°å½•
        function showHistory() {
            loadHistory();
            showPage('history-page');
        }

        // æ˜¾ç¤ºé”™é¢˜æœ¬
        function showMistakes() {
            loadMistakes();
            showPage('mistakes-page');
        }

        // è¿”å›ç»“æœé¡µé¢
        function goToResultPage() {
            showPage('result-page');
        }

        // å¤„ç†é”®ç›˜äº‹ä»¶ - ä¿®å¤è¾“å…¥é—®é¢˜
        function handleKeyPress(e) {
            // è¾“å…¥æ¡†èšç„¦æ—¶ï¼Œåªå¤„ç†å›è½¦é”®ï¼ˆæäº¤ï¼‰
            if (document.activeElement === wordInput) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkAnswer();
                }
                // å…¶ä»–æŒ‰é”®å…è®¸æ­£å¸¸è¾“å…¥
                return;
            }

            // è¾“å…¥æ¡†æœªèšç„¦æ—¶å¤„ç†å…¶ä»–å¿«æ·é”®
            if (quizPage.classList.contains('active')) {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        togglePause();
                        break;
                    case 'h':
                    case 'H':
                        e.preventDefault();
                        showHint();
                        break;
                    case 's':
                    case 'S':
                        e.preventDefault();
                        skipWord();
                        break;
                    case 'Enter':
                        e.preventDefault();
                        checkAnswer();
                        break;
                }
            }
        }

        // å•è¯å‘éŸ³ - ä¿®å¤å‘éŸ³é—®é¢˜
        function pronounceWord() {
            // ç¡®ä¿å½“å‰æœ‰å•è¯
            if (currentIndex >= currentVocabulary.length) return;
            
            const currentWord = currentVocabulary[currentIndex];
            
            // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„å‘éŸ³
            window.speechSynthesis.cancel();
            
            // åˆ›å»ºæ–°çš„å‘éŸ³å®ä¾‹
            const utterance = new SpeechSynthesisUtterance(currentWord.english);
            utterance.lang = 'en-US';
            utterance.rate = 0.9; // ç¨æ…¢ä¸€ç‚¹ï¼Œä¾¿äºå¬æ¸…
            
            // ç¡®ä¿å‘éŸ³APIå‡†å¤‡å°±ç»ª
            if (window.speechSynthesis.pending) {
                window.speechSynthesis.cancel();
            }
            
            // å‘éŸ³
            window.speechSynthesis.speak(utterance);
            
            // è§†è§‰åé¦ˆ
            pronounceBtn.classList.add('btn-success');
            setTimeout(() => {
                pronounceBtn.classList.remove('btn-success');
            }, 300);
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // è®¾ç½®ä¸åŒçš„éŸ³è°ƒ
            if (type === 'correct') {
                // ä¸Šå‡éŸ³è°ƒ C-E-G
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime); // C4
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); // E4
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime + 0.2); // G4
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } else if (type === 'error') {
                // ä¸‹é™éŸ³è°ƒ
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); // G4
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); // E4
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.2); // C4
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }

        // æ•°ç»„éšæœºæ’åº
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // æœ¬åœ°å­˜å‚¨ - å†å²è®°å½•
        function saveHistory(historyItem) {
            let history = JSON.parse(localStorage.getItem('dictationHistory') || '[]');
            history.unshift(historyItem); // æ·»åŠ åˆ°å¼€å¤´
            
            // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            localStorage.setItem('dictationHistory', JSON.stringify(history));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('dictationHistory') || '[]');
            historyListElement.innerHTML = '';
            
            if (history.length === 0) {
                historyListElement.innerHTML = '<div style="text-align: center; padding: 20px;">æš‚æ— å†å²è®°å½•</div>';
                return;
            }
            
            history.forEach(item => {
                const date = new Date(item.date);
                const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const difficultyNames = {
                    'basic': 'åŸºç¡€',
                    'intermediate': 'ä¸­çº§',
                    'advanced': 'é«˜çº§',
                    'mixed': 'æ··åˆ'
                };
                
                const itemElement = document.createElement('div');
                itemElement.className = 'history-item';
                itemElement.innerHTML = `
                    <div>
                        <div>${formattedDate} Â· ${difficultyNames[item.difficulty]}</div>
                        <div>æ­£ç¡®ç‡: ${item.accuracy}%</div>
                    </div>
                    <div style="font-weight: bold; color: var(--primary-1);">${item.score} åˆ†</div>
                `;
                historyListElement.appendChild(itemElement);
            });
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                localStorage.removeItem('dictationHistory');
                loadHistory();
            }
        }

        // æœ¬åœ°å­˜å‚¨ - é”™é¢˜æœ¬
        function addToMistakes(word) {
            let mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ·»åŠ 
            const exists = mistakes.some(m => m.english.toLowerCase() === word.english.toLowerCase());
            if (!exists) {
                mistakes.push({
                    english: word.english,
                    chinese: word.chinese,
                    addedDate: new Date().toISOString()
                });
                localStorage.setItem('dictationMistakes', JSON.stringify(mistakes));
            }
        }

        function loadMistakes() {
            const mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            mistakesListElement.innerHTML = '';
            
            if (mistakes.length === 0) {
                mistakesListElement.innerHTML = '<div style="text-align: center; padding: 20px;">æš‚æ— é”™é¢˜è®°å½•</div>';
                return;
            }
            
            // æŒ‰æ·»åŠ æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            mistakes.sort((a, b) => new Date(b.addedDate) - new Date(a.addedDate));
            
            mistakes.forEach(mistake => {
                const itemElement = document.createElement('div');
                itemElement.className = 'mistake-item';
                itemElement.innerHTML = `
                    <div class="mistake-word">${mistake.english}</div>
                    <div class="mistake-meaning">${mistake.chinese}</div>
                    <button class="btn btn-sm btn-outline pronounce-mistake" data-word="${mistake.english}">
                        <i class="fas fa-volume-up"></i>
                    </button>
                `;
                mistakesListElement.appendChild(itemElement);
            });
            
            // ä¸ºé”™é¢˜æ·»åŠ å‘éŸ³åŠŸèƒ½
            document.querySelectorAll('.pronounce-mistake').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const word = e.currentTarget.dataset.word;
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                });
            });
        }

        function clearMistakes() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™é¢˜è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                localStorage.removeItem('dictationMistakes');
                loadMistakes();
            }
        }

        // ä¸‹è½½é”™é¢˜æœ¬ - ç¡®ä¿ä½¿ç”¨UTF-8ç¼–ç å¹¶æ·»åŠ BOMå¤´è§£å†³ä¸­æ–‡ä¹±ç 
        function downloadMistakes() {
            const mistakes = JSON.parse(localStorage.getItem('dictationMistakes') || '[]');
            
            if (mistakes.length === 0) {
                alert('æš‚æ— é”™é¢˜å¯ä¸‹è½½');
                return;
            }
            
            // ç”ŸæˆCSVå†…å®¹ï¼Œæ·»åŠ UTF-8 BOMå¤´è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
            // \ufeffæ˜¯UTF-8 BOMå¤´ï¼Œå¸®åŠ©Excelæ­£ç¡®è¯†åˆ«ç¼–ç 
            let csvContent = "\ufeffè‹±æ–‡å•è¯,ä¸­æ–‡é‡Šä¹‰\n";
            mistakes.forEach(mistake => {
                // å¤„ç†åŒ…å«é€—å·æˆ–å¼•å·çš„å†…å®¹
                const english = `"${mistake.english.replace(/"/g, '""')}"`;
                const chinese = `"${mistake.chinese.replace(/"/g, '""')}"`;
                csvContent += `${english},${chinese}\n`;
            });
            
            // åˆ›å»ºBlobæ—¶æ˜ç¡®æŒ‡å®šUTF-8ç¼–ç 
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `è‹±è¯­å¬å†™é”™é¢˜æœ¬_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // é‡Šæ”¾URLå¯¹è±¡
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
        }

        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    