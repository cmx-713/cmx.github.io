<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ËØ≠ËØçÊ±áÂê¨ÂÜôÁ≥ªÁªü - English Vocabulary Dictation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --error-color: #f43f5e;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --bg-primary: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 100%);
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-heavy: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-small: 8px;
            --radius-medium: 12px;
            --radius-large: 20px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            background: var(--bg-card);
            border-radius: var(--radius-large);
            box-shadow: var(--shadow-heavy);
            width: 100%;
            max-width: 900px;
            min-height: 650px;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: var(--radius-large);
            padding: 2px;
            background: var(--bg-gradient);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: subtract;
            -webkit-mask-composite: source-out;
            pointer-events: none;
        }

        .header {
            background: var(--bg-gradient);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '‚ú®üìö‚úèÔ∏èüéØ';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 1.2rem;
            opacity: 0.7;
            animation: float 3s ease-in-out infinite;
        }

        .header::after {
            content: 'üéìüìñüåüüí´';
            position: absolute;
            bottom: 10px;
            left: 20px;
            font-size: 1.2rem;
            opacity: 0.7;
            animation: float 3s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1::before {
            content: 'üé™';
            margin-right: 10px;
            font-size: 2rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 400;
        }


        .progress-container {
            padding: 20px 30px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .main-content {
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 450px;
            justify-content: center;
        }

        .welcome-screen {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-screen h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 300;
        }

        .difficulty-selection {
            margin: 20px 0;
        }

        .difficulty-selection h3 {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-weight: 400;
        }

        .difficulty-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            padding: 12px 24px;
            border: 2px solid var(--accent-color);
            background: white;
            color: var(--accent-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.9rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--accent-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
            z-index: -1;
        }

        .difficulty-btn:hover::before {
            width: 200%;
            height: 200%;
        }

        .difficulty-btn:hover, .difficulty-btn.active {
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        .difficulty-btn.active::before {
            width: 200%;
            height: 200%;
        }

        .mode-selection {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .mode-display {
            background: linear-gradient(135deg, var(--info-color), var(--accent-color));
            color: white;
            padding: 20px 30px;
            border-radius: var(--radius-medium);
            text-align: center;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .mode-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .mode-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 8px;
        }

        .mode-text {
            font-size: 1.1rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .start-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: var(--shadow-light);
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .start-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .question-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-medium);
            padding: 40px;
            text-align: center;
            width: 100%;
            max-width: 600px;
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .timer-controls {
            position: absolute;
            top: -20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .timer {
            background: var(--error-color);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
        }

        .timer.warning {
            background: var(--warning-color);
            animation: pulse 1s infinite;
        }

        .timer.paused {
            background: var(--text-secondary);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pause-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .pause-btn:hover {
            background: var(--primary-color);
        }

        .word-display {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 300;
            position: relative;
        }

        .pronunciation-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 15px;
            transition: all 0.3s ease;
        }

        .pronunciation-btn:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }

        .word-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .word-length-hint {
            background: var(--bg-secondary);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .input-group {
            margin: 30px 0;
            position: relative;
        }

        .word-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .word-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(108, 123, 127, 0.1);
        }

        .input-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .submit-btn, .hint-btn, .skip-btn {
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .submit-btn {
            background: var(--success-color);
            color: white;
        }

        .hint-btn {
            background: var(--warning-color);
            color: white;
        }

        .skip-btn {
            background: var(--text-secondary);
            color: white;
        }

        .submit-btn:hover:not(:disabled) {
            background: #6da054;
            transform: translateY(-1px);
        }

        .hint-btn:hover:not(:disabled) {
            background: #ebc374;
            transform: translateY(-1px);
        }

        .skip-btn:hover:not(:disabled) {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .submit-btn:disabled, .hint-btn:disabled, .skip-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            text-align: center;
            animation: feedbackSlide 0.5s ease;
        }

        @keyframes feedbackSlide {
            from {
                transform: translateY(10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .feedback.correct {
            background: rgba(127, 176, 105, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(127, 176, 105, 0.3);
        }

        .feedback.incorrect {
            background: rgba(224, 122, 95, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(224, 122, 95, 0.3);
        }

        .hint-display {
            background: rgba(242, 204, 143, 0.1);
            color: var(--warning-color);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            border: 1px solid rgba(242, 204, 143, 0.3);
        }

        .result-screen {
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        .final-score {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .score-details {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .restart-btn, .history-btn, .mistakes-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .restart-btn:hover, .history-btn:hover, .mistakes-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .mistakes-btn {
            background: linear-gradient(135deg, var(--error-color) 0%, #f2a089 100%);
        }

        .mistakes-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .word-list {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-item:hover {
            background: rgba(108, 123, 127, 0.05);
            border-radius: 5px;
        }

        .word-status {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-correct {
            background: rgba(127, 176, 105, 0.2);
            color: var(--success-color);
        }

        .status-incorrect {
            background: rgba(224, 122, 95, 0.2);
            color: var(--error-color);
        }

        .status-hint {
            background: rgba(242, 204, 143, 0.2);
            color: var(--warning-color);
        }

        .status-skip {
            background: rgba(108, 123, 127, 0.2);
            color: var(--text-secondary);
        }

        .history-modal, .mistakes-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .mistakes-list {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .mistake-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--error-color);
        }

        .mistake-word {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .mistake-english {
            font-weight: bold;
            color: var(--text-primary);
        }

        .mistake-chinese {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .download-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #6da054;
            transform: translateY(-1px);
        }

        .download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }


        .hidden {
            display: none !important;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ°‰ºòÂåñ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .main-content {
                padding: 20px 15px;
            }

            .question-card {
                padding: 25px 20px;
                margin: 0;
            }

            .word-display {
                font-size: 2rem;
            }

            .mode-selection {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 200px;
            }

            .input-controls {
                flex-direction: column;
                align-items: center;
            }

            .submit-btn, .hint-btn, .skip-btn {
                width: 120px;
            }

            .timer-controls {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }

            .word-info {
                flex-direction: column;
                align-items: center;
            }

            .stats-toggle {
                position: static;
                margin-top: 10px;
                display: block;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .word-display {
                font-size: 1.5rem;
            }

            .question-card {
                padding: 20px 15px;
            }

            .final-score {
                font-size: 3rem;
            }
        }

        /* Èü≥ÊïàÂíåÂä®ÁîªÂ¢ûÂº∫ */
        .bounce {
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        .shake {
            animation: shake 0.6s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .glow {
            box-shadow: 0 0 20px rgba(127, 176, 105, 0.5);
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ëã±ËØ≠ËØçÊ±áÂê¨ÂÜôÁ≥ªÁªü</h1>
            <p>English Vocabulary Dictation System</p>
        </div>

        <div class="progress-container hidden" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">ÂáÜÂ§áÂºÄÂßã...</span>
                <span id="scoreText">ÂæóÂàÜ: 0/0</span>
            </div>
        </div>

        <div class="main-content">
            <!-- Ê¨¢ËøéÁïåÈù¢ -->
            <div class="welcome-screen" id="welcomeScreen">
                <h2>Ê¨¢Ëøé‰ΩøÁî®Ëã±ËØ≠ËØçÊ±áÂê¨ÂÜôÁ≥ªÁªü</h2>
                <p>ÈÄâÊã©ÈöæÂ∫¶ÂíåÂê¨ÂÜôÊ®°ÂºèÔºåÊØè‰∏™ÂçïËØçÊúâ30Áßí‰ΩúÁ≠îÊó∂Èó¥</p>
                
                <div class="difficulty-selection">
                    <h3>ÈÄâÊã©ÈöæÂ∫¶Á∫ßÂà´</h3>
                    <div class="difficulty-options">
                        <button class="difficulty-btn active" data-difficulty="basic">Âü∫Á°ÄËØçÊ±á</button>
                        <button class="difficulty-btn" data-difficulty="intermediate">‰∏≠Á∫ßËØçÊ±á</button>
                        <button class="difficulty-btn" data-difficulty="advanced">È´òÁ∫ßËØçÊ±á</button>
                        <button class="difficulty-btn" data-difficulty="mixed">Ê∑∑ÂêàÊ®°Âºè</button>
                    </div>
                </div>
                
                <div class="mode-selection">
                    <div class="mode-display">
                        <span class="mode-icon">üá®üá≥ ‚û°Ô∏è üá¨üáß</span>
                        <span class="mode-text">‰∏≠Êñá ‚Üí Ëã±ÊñáÂê¨ÂÜô</span>
                    </div>
                </div>

                
                <button class="start-btn" id="startBtn">ÂºÄÂßãÂê¨ÂÜô</button>
            </div>

            <!-- Á≠îÈ¢òÁïåÈù¢ -->
            <div class="question-card hidden" id="questionCard">
                <div class="timer-controls">
                    <button class="pause-btn" id="pauseBtn">ÊöÇÂÅú</button>
                    <div class="timer" id="timer">30</div>
                </div>
                
                <div class="word-display" id="wordDisplay">
                    <span id="wordText"></span>
                    <button class="pronunciation-btn" id="pronunciationBtn">üîä ÂèëÈü≥</button>
                </div>
                
                <div class="word-info">
                    <div class="word-length-hint" id="lengthHint">Â≠óÊØçÊï∞: ?</div>
                </div>
                
                <div class="input-group">
                    <input type="text" class="word-input" id="wordInput" placeholder="ËØ∑ËæìÂÖ•Á≠îÊ°à" autocomplete="off">
                    <div class="input-controls">
                        <button class="hint-btn" id="hintBtn">ÊèêÁ§∫</button>
                        <button class="submit-btn" id="submitBtn">Êèê‰∫§</button>
                        <button class="skip-btn" id="skipBtn">Ë∑≥Ëøá</button>
                    </div>
                    <div class="hint-display hidden" id="hintDisplay"></div>
                </div>
                
                <div class="feedback hidden" id="feedback"></div>
            </div>

            <!-- ÁªìÊûúÁïåÈù¢ -->
            <div class="result-screen hidden" id="resultScreen">
                <h2>Âê¨ÂÜôÂÆåÊàêÔºÅ</h2>
                <div class="final-score" id="finalScore">0%</div>
                <div class="score-details">
                    <div class="score-row">
                        <span>ÊÄªÈ¢òÊï∞:</span>
                        <span id="totalQuestions">0</span>
                    </div>
                    <div class="score-row">
                        <span>Ê≠£Á°ÆÊï∞:</span>
                        <span id="correctAnswers">0</span>
                    </div>
                    <div class="score-row">
                        <span>‰ΩøÁî®ÊèêÁ§∫:</span>
                        <span id="hintUsed">0</span>
                    </div>
                    <div class="score-row">
                        <span>Ë∑≥ËøáÈ¢òÁõÆ:</span>
                        <span id="skippedQuestions">0</span>
                    </div>
                    <div class="score-row">
                        <span>Ê≠£Á°ÆÁéá:</span>
                        <span id="accuracyRate">0%</span>
                    </div>
                </div>
                
                <div class="word-list" id="wordList"></div>
                
                <div>
                    <button class="restart-btn" id="restartBtn">ÈáçÊñ∞ÂºÄÂßã</button>
                    <button class="history-btn" id="historyBtn">Êü•ÁúãÂéÜÂè≤</button>
                    <button class="mistakes-btn" id="mistakesBtn">ÈîôÈ¢òÊú¨</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div class="history-modal hidden" id="historyModal">
        <div class="modal-content">
            <button class="close-btn" id="closeHistoryModal">&times;</button>
            <h2>ÂéÜÂè≤ËÆ∞ÂΩï‰∏éÁªüËÆ°</h2>
            <div id="historyContent"></div>
        </div>
    </div>

    <!-- ÈîôÈ¢òÊú¨Ê®°ÊÄÅÊ°Ü -->
    <div class="mistakes-modal hidden" id="mistakesModal">
        <div class="modal-content">
            <button class="close-btn" id="closeMistakesModal">&times;</button>
            <h2>ÈîôÈ¢òÊú¨</h2>
            <p>Êú¨Ê¨°Âê¨ÂÜô‰∏≠ÁöÑÈîôËØØËØçÊ±á</p>
            <button class="download-btn" id="downloadBtn">üì• ‰∏ãËΩΩExcelÈîôÈ¢òÊú¨</button>
            <div class="mistakes-list" id="mistakesList"></div>
        </div>
    </div>

    <script>
        // Êâ©Â±ïËØçÊ±áÊï∞ÊçÆÂ∫ì
        const vocabularyDatabase = {
            basic: [
               { english: 'device', chinese: 'ËÆæÂ§áÔºõ‰ª™Âô®ÔºõË£ÖÁΩÆ' },
               { english: 'tablet', chinese: 'Âπ≥ÊùøÁîµËÑëÔºõËçØÁâá' },
              { english: 'volume', chinese: 'Èü≥ÈáèÔºõ‰ΩìÁßØÔºõÈáè' },
              { english: 'domestic', chinese: 'ÂÆ∂Â∫≠ÁöÑÔºõÂõΩÂÜÖÁöÑ' },
             { english: 'chore', chinese: 'ÂÆ∂Â∫≠ÊùÇÂä°ÔºõÊó•Â∏∏Áêê‰∫ã' },
             { english: 'burden', chinese: 'Ë¥üÊãÖÔºõÈáçÊãÖ' },
            { english: 'alter', chinese: 'ÊîπÂèòÔºõÂèòÂåñ' },
           { english: 'assess', chinese: 'ËØÑ‰º∞ÔºõËØÑÂÆö' },
          { english: 'executive', chinese: '‰∏ªÁÆ°ÔºõÁªèÁêÜ' },
          { english: 'consultant', chinese: 'È°æÈóÆ' }
            ],
           intermediate: [
    { english: 'scenario', chinese: 'ÂèØËÉΩÂèëÁîüÁöÑ‰∫ãÔºõÂâßÊÉÖÊ¢óÊ¶Ç' },
    { english: 'furious', chinese: 'ÁãÇÊÄíÁöÑÔºõÁåõÁÉàÁöÑ' },
    { english: 'convention', chinese: '‰π†‰øóÔºõÂ§ß‰ºöÔºõÂÖ¨Á∫¶' },
    { english: 'tribe', chinese: 'ÈÉ®ËêΩÔºõ‰∏Ä‰ºô‰∫∫' },
    { english: 'immerse', chinese: 'ÊΩúÂøÉ‰∫éÔºõÊµ∏Ê≤°' },
    { english: 'associate', chinese: 'Âêå‰∫ãÔºõ‰ºô‰º¥ÔºõËÅîÊÉ≥' },
    { english: 'suite', chinese: 'Â•óÊàøÔºõ‰∏ÄÂ•ó' },
    { english: 'lure', chinese: 'ËØ±ÊÉëÔºõÂºïËØ±' },
    { english: 'convert', chinese: 'ËΩ¨ÂèòÔºõÁöà‰æù' },
    { english: 'nuance', chinese: 'ÁªÜÂæÆÂ∑ÆÂà´' }
  ],
          advanced: [
    { english: 'velocity', chinese: 'ÈÄüÂ∫¶' },
    { english: 'acceleration', chinese: 'Âä†ÈÄüÔºõÂ¢ûÈÄü' },
    { english: 'deletion', chinese: 'Âà†Èô§' },
    { english: 'deceptive', chinese: 'Ê¨∫È™óÊÄßÁöÑ' },
    { english: 'commerce', chinese: 'ÂïÜ‰∏öÔºõË¥∏Êòì' },
    { english: 'reflective', chinese: 'Ê≤âÊÄùÁöÑÔºõÂèçÂÖâÁöÑ' },
    { english: 'substitute', chinese: 'Êõø‰ª£ÂìÅÔºõ‰ª£Êõø' },
    { english: 'discrete', chinese: 'Á¶ªÊï£ÁöÑÔºõÂàÜÂºÄÁöÑ' },
    { english: 'adequacy', chinese: 'ÂÖÖÂàÜÔºõË∂≥Â§ü' },
    { english: 'observant', chinese: 'ËßÇÂØüÂäõÊïèÈîêÁöÑ' }
  ]
        };

        // Â∫îÁî®Áä∂ÊÄÅ
        let currentMode = 'chineseToEnglish'; // Âõ∫ÂÆö‰∏∫‰∏≠ËØëËã±Ê®°Âºè
        let currentDifficulty = 'basic';
        let currentQuestionIndex = 0;
        let score = 0;
        let timeLeft = 30;
        let timer = null;
        let isPaused = false;
        let questions = [];
        let answers = [];
        let hintsUsed = 0;
        let questionsSkipped = 0;
        let speechSynthesis = window.speechSynthesis;

        // Êú¨Âú∞Â≠òÂÇ®ÁöÑÁªüËÆ°Êï∞ÊçÆ
        let statistics = {
            sessions: [],
            wordErrors: {},
            totalSessions: 0,
            bestScore: 0
        };

        // DOM ÂÖÉÁ¥†
        const welcomeScreen = document.getElementById('welcomeScreen');
        const questionCard = document.getElementById('questionCard');
        const resultScreen = document.getElementById('resultScreen');
        const progressContainer = document.getElementById('progressContainer');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        const startBtn = document.getElementById('startBtn');
        const wordText = document.getElementById('wordText');
        const pronunciationBtn = document.getElementById('pronunciationBtn');
        const lengthHint = document.getElementById('lengthHint');
        const wordInput = document.getElementById('wordInput');
        const submitBtn = document.getElementById('submitBtn');
        const hintBtn = document.getElementById('hintBtn');
        const skipBtn = document.getElementById('skipBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const timerDisplay = document.getElementById('timer');
        const feedback = document.getElementById('feedback');
        const hintDisplay = document.getElementById('hintDisplay');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const scoreText = document.getElementById('scoreText');
        const restartBtn = document.getElementById('restartBtn');
        const historyBtn = document.getElementById('historyBtn');
        const mistakesBtn = document.getElementById('mistakesBtn');
        const historyModal = document.getElementById('historyModal');
        const mistakesModal = document.getElementById('mistakesModal');
        const closeHistoryModal = document.getElementById('closeHistoryModal');
        const closeMistakesModal = document.getElementById('closeMistakesModal');
        const downloadBtn = document.getElementById('downloadBtn');
        const mistakesList = document.getElementById('mistakesList');

        // ÂàùÂßãÂåñ
        loadStatistics();

        // Èü≥ÊïàÁõ∏ÂÖ≥
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, type = 'sine', duration = 200) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        function playCorrectSound() {
            playSound(523.25, 'sine', 300); // C5
            setTimeout(() => playSound(659.25, 'sine', 300), 150); // E5
            setTimeout(() => playSound(783.99, 'sine', 400), 300); // G5
        }

        function playIncorrectSound() {
            playSound(220, 'sawtooth', 400); // A3
            setTimeout(() => playSound(196, 'sawtooth', 600), 200); // G3
        }

        function playHintSound() {
            playSound(440, 'triangle', 200); // A4
        }

        // ÈöæÂ∫¶ÈÄâÊã©
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                difficultyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.difficulty;
            });
        });


        // ÂèëÈü≥ÂäüËÉΩ - ‰øÆÂ§çÂÖºÂÆπÊÄßÈóÆÈ¢ò
        pronunciationBtn.addEventListener('click', () => {
            const currentQuestion = questions[currentQuestionIndex];
            if (currentQuestion && 'speechSynthesis' in window) {
                // ÂÅúÊ≠¢‰ªª‰ΩïÊ≠£Âú®ËøõË°åÁöÑËØ≠Èü≥ÂêàÊàê
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(currentQuestion.english);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.volume = 1;
                utterance.pitch = 1;
                
                // Â§ÑÁêÜËØ≠Èü≥ÂêàÊàêÁöÑÂõûË∞É
                utterance.onstart = () => {
                    pronunciationBtn.textContent = 'üîä Êí≠Êîæ‰∏≠...';
                    pronunciationBtn.disabled = true;
                };
                
                utterance.onend = () => {
                    pronunciationBtn.textContent = 'üîä ÂèëÈü≥';
                    pronunciationBtn.disabled = false;
                };
                
                utterance.onerror = (event) => {
                    console.log('Speech synthesis error:', event);
                    pronunciationBtn.textContent = 'üîä ÂèëÈü≥';
                    pronunciationBtn.disabled = false;
                };
                
                // Á°Æ‰øùËØ≠Èü≥ÂêàÊàêÊúçÂä°Â∑≤ÂáÜÂ§áÂ∞±Áª™
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        speechSynthesis.speak(utterance);
                    }, { once: true });
                } else {
                    speechSynthesis.speak(utterance);
                }
            } else {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÂêàÊàêÂäüËÉΩ');
            }
        });


        // ÂºÄÂßãÂê¨ÂÜô
        startBtn.addEventListener('click', startDictation);

        function startDictation() {
            // ÈáçÁΩÆÁä∂ÊÄÅ
            currentQuestionIndex = 0;
            score = 0;
            answers = [];
            hintsUsed = 0;
            questionsSkipped = 0;
            
            // ÂáÜÂ§áÈ¢òÁõÆ
            let vocabulary = [];
            
            // ‰ΩøÁî®È¢ÑËÆæËØçÊ±á
            if (currentDifficulty === 'mixed') {
                vocabulary = [...vocabularyDatabase.basic, ...vocabularyDatabase.intermediate, ...vocabularyDatabase.advanced];
            } else {
                vocabulary = [...vocabularyDatabase[currentDifficulty]];
            }
            
            if (vocabulary.length === 0) {
                alert('ËØ∑ÂÖàÈÄâÊã©ÈöæÂ∫¶ÔºÅ');
                return;
            }
            
            questions = vocabulary.sort(() => Math.random() - 0.5);
            
            // ÂàáÊç¢ÁïåÈù¢
            welcomeScreen.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            questionCard.classList.remove('hidden');
            
            // ÂºÄÂßãÁ¨¨‰∏ÄÈ¢ò
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestionIndex];
            
            // ÊòæÁ§∫‰∏≠ÊñáÔºåËÆ©Áî®Êà∑ËæìÂÖ•Ëã±Êñá
            wordText.textContent = question.chinese;
            wordInput.placeholder = 'ËØ∑ËæìÂÖ•Ëã±ÊñáÂçïËØç';
            lengthHint.textContent = `Â≠óÊØçÊï∞: ${question.english.length}`;
            
            // ÈáçÁΩÆËæìÂÖ•Ê°ÜÂíåÂèçÈ¶à
            wordInput.value = '';
            wordInput.disabled = false;
            submitBtn.disabled = false;
            hintBtn.disabled = false;
            skipBtn.disabled = false;
            feedback.classList.add('hidden');
            hintDisplay.classList.add('hidden');
            
            // ÈáçÁΩÆÂä®Áîª
            questionCard.style.animation = 'none';
            questionCard.offsetHeight;
            questionCard.style.animation = 'slideIn 0.5s ease forwards';
            
            // Êõ¥Êñ∞ËøõÂ∫¶
            updateProgress();
            
            // ÂºÄÂßãÂÄíËÆ°Êó∂
            startTimer();
            
            // ÁÑ¶ÁÇπÂà∞ËæìÂÖ•Ê°Ü
            wordInput.focus();
        }

        function startTimer() {
            timeLeft = 30;
            isPaused = false;
            pauseBtn.textContent = 'ÊöÇÂÅú';
            timerDisplay.textContent = timeLeft;
            timerDisplay.classList.remove('warning', 'paused');
            
            timer = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    
                    if (timeLeft <= 10) {
                        timerDisplay.classList.add('warning');
                    }
                    
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        submitAnswer();
                    }
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        // ÊöÇÂÅúÂäüËÉΩ
        pauseBtn.addEventListener('click', () => {
            isPaused = !isPaused;
            if (isPaused) {
                pauseBtn.textContent = 'ÁªßÁª≠';
                timerDisplay.classList.add('paused');
                wordInput.disabled = true;
                submitBtn.disabled = true;
                hintBtn.disabled = true;
                skipBtn.disabled = true;
            } else {
                pauseBtn.textContent = 'ÊöÇÂÅú';
                timerDisplay.classList.remove('paused');
                wordInput.disabled = false;
                submitBtn.disabled = false;
                hintBtn.disabled = false;
                skipBtn.disabled = false;
                wordInput.focus();
            }
        });

        // ÊèêÁ§∫ÂäüËÉΩ
        hintBtn.addEventListener('click', () => {
            const question = questions[currentQuestionIndex];
            const correctAnswer = question.english;
            
            // Ëã±ÊñáÂçïËØçÊèêÁ§∫Ââç‰∏§‰∏™Â≠óÊØç
            const hint = `Ââç‰∏§‰∏™Â≠óÊØç: ${correctAnswer.substring(0, 2).toUpperCase()}___`;
            
            hintDisplay.textContent = hint;
            hintDisplay.classList.remove('hidden');
            hintBtn.disabled = true;
            hintsUsed++;
            
            playHintSound();
        });

        // Ë∑≥ËøáÂäüËÉΩ
        skipBtn.addEventListener('click', () => {
            stopTimer();
            questionsSkipped++;
            
            const question = questions[currentQuestionIndex];
            answers.push({
                question: question,
                userAnswer: '',
                correctAnswer: question.english,
                isCorrect: false,
                isSkipped: true,
                timeUsed: 30 - timeLeft,
                hintUsed: false
            });
            
            showFeedback(false, `Â∑≤Ë∑≥ËøáÔºÅÊ≠£Á°ÆÁ≠îÊ°àÊòØÔºö${question.english}`, 'skip');
            
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 2000);
        });

        // Êèê‰∫§Á≠îÊ°à
        submitBtn.addEventListener('click', submitAnswer);
        wordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !isPaused) {
                submitAnswer();
            }
        });

        function submitAnswer() {
            if (isPaused) return;
            
            stopTimer();
            
            const userAnswer = normalizeAnswer(wordInput.value.trim());
            const question = questions[currentQuestionIndex];
            const correctAnswer = normalizeAnswer(question.english);
            
            const isCorrect = userAnswer === correctAnswer;
            const hintWasUsed = !hintDisplay.classList.contains('hidden');
            
            // ËÆ∞ÂΩïÈîôËØØËØçÊ±áÁªüËÆ°
            if (!isCorrect) {
                const wordKey = `${question.english}-${question.chinese}`;
                statistics.wordErrors[wordKey] = (statistics.wordErrors[wordKey] || 0) + 1;
            }
            
            // ËÆ∞ÂΩïÁ≠îÊ°à
            answers.push({
                question: question,
                userAnswer: wordInput.value.trim(),
                correctAnswer: question.english,
                isCorrect: isCorrect,
                isSkipped: false,
                timeUsed: 30 - timeLeft,
                hintUsed: hintWasUsed
            });
            
            if (isCorrect) {
                score++;
                playCorrectSound();
                questionCard.classList.add('bounce');
                showFeedback(true, `Ê≠£Á°ÆÔºÅ${hintWasUsed ? '(‰ΩøÁî®‰∫ÜÊèêÁ§∫)' : ''}`, 'correct');
            } else {
                playIncorrectSound();
                questionCard.classList.add('shake');
                showFeedback(false, `ÈîôËØØÔºÅÊ≠£Á°ÆÁ≠îÊ°àÊòØÔºö${question.english}`, 'incorrect');
            }
            
            // Á¶ÅÁî®ËæìÂÖ•
            wordInput.disabled = true;
            submitBtn.disabled = true;
            hintBtn.disabled = true;
            skipBtn.disabled = true;
            
            // ÁßªÈô§Âä®ÁîªÁ±ª
            setTimeout(() => {
                questionCard.classList.remove('bounce', 'shake');
            }, 600);
            
            // 2ÁßíÂêéÊòæÁ§∫‰∏ã‰∏ÄÈ¢ò
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 2000);
        }

        // Á≠îÊ°àÊ†áÂáÜÂåñÂ§ÑÁêÜ
        function normalizeAnswer(answer) {
            return answer.toLowerCase()
                        .replace(/\s+/g, ' ')  // Â§ö‰∏™Á©∫Ê†ºÊõøÊç¢‰∏∫Âçï‰∏™Á©∫Ê†º
                        .trim()                // ÂéªÈô§È¶ñÂ∞æÁ©∫Ê†º
                        .replace(/[.,!?;:]/g, ''); // ÁßªÈô§Ê†áÁÇπÁ¨¶Âè∑
        }

        function showFeedback(isCorrect, message, type) {
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.classList.remove('hidden');
            
            if (isCorrect) {
                feedback.classList.add('glow');
                setTimeout(() => feedback.classList.remove('glow'), 1000);
            }
        }

        function updateProgress() {
            const progress = (currentQuestionIndex / questions.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `Á¨¨ ${currentQuestionIndex + 1} È¢ò / ÂÖ± ${questions.length} È¢ò`;
            scoreText.textContent = `ÂæóÂàÜ: ${score}/${currentQuestionIndex}`;
        }

        function showResults() {
            // ÈöêËóèÂÖ∂‰ªñÁïåÈù¢
            questionCard.classList.add('hidden');
            progressContainer.classList.add('hidden');
            
            // ÊòæÁ§∫ÁªìÊûúÁïåÈù¢
            resultScreen.classList.remove('hidden');
            
            // ËÆ°ÁÆóÂπ∂ÊòæÁ§∫ÁªìÊûú
            const accuracy = Math.round((score / questions.length) * 100);
            const incorrect = questions.length - score;
            
            document.getElementById('finalScore').textContent = `${accuracy}%`;
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('correctAnswers').textContent = score;
            document.getElementById('hintUsed').textContent = hintsUsed;
            document.getElementById('skippedQuestions').textContent = questionsSkipped;
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
            
            // ‰øùÂ≠òÁªüËÆ°Êï∞ÊçÆ
            saveSessionData(accuracy);
            
            // ÊòæÁ§∫ËØ¶ÁªÜÁªìÊûú
            showWordList();
            
            // Êõ¥Êñ∞ÈîôÈ¢òÊú¨ÊåâÈíÆÁä∂ÊÄÅ
            updateMistakesButton();
        }

        function showWordList() {
            const wordList = document.getElementById('wordList');
            wordList.innerHTML = '';
            
            answers.forEach((answer, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                
                const questionText = `${answer.question.chinese} ‚Üí ${answer.question.english}`;
                
                let statusText = '';
                let statusClass = '';
                
                if (answer.isSkipped) {
                    statusText = 'Ë∑≥Ëøá';
                    statusClass = 'status-skip';
                } else if (answer.isCorrect) {
                    statusText = answer.hintUsed ? '‚úì Ê≠£Á°Æ(ÊèêÁ§∫)' : '‚úì Ê≠£Á°Æ';
                    statusClass = answer.hintUsed ? 'status-hint' : 'status-correct';
                } else {
                    statusText = '‚úó ÈîôËØØ';
                    statusClass = 'status-incorrect';
                }
                
                wordItem.innerHTML = `
                    <span>${questionText}</span>
                    <span class="word-status ${statusClass}">${statusText}</span>
                `;
                
                wordList.appendChild(wordItem);
            });
        }

        // ‰øùÂ≠ò‰ºöËØùÊï∞ÊçÆ
        function saveSessionData(accuracy) {
            const sessionData = {
                date: new Date().toISOString(),
                mode: currentMode,
                difficulty: currentDifficulty,
                totalQuestions: questions.length,
                correctAnswers: score,
                accuracy: accuracy,
                hintsUsed: hintsUsed,
                questionsSkipped: questionsSkipped,
                answers: answers
            };
            
            statistics.sessions.push(sessionData);
            statistics.totalSessions++;
            if (accuracy > statistics.bestScore) {
                statistics.bestScore = accuracy;
            }
            
            // Âè™‰øùÁïôÊúÄËøë20Ê¨°ËÆ∞ÂΩï
            if (statistics.sessions.length > 20) {
                statistics.sessions = statistics.sessions.slice(-20);
            }
            
            localStorage.setItem('dictationStatistics', JSON.stringify(statistics));
        }

        // Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆ
        function loadStatistics() {
            const saved = localStorage.getItem('dictationStatistics');
            if (saved) {
                statistics = JSON.parse(saved);
            }
        }

        // Êõ¥Êñ∞ÈîôÈ¢òÊú¨ÊåâÈíÆÁä∂ÊÄÅ
        function updateMistakesButton() {
            const mistakes = answers.filter(answer => !answer.isCorrect && !answer.isSkipped);
            mistakesBtn.disabled = mistakes.length === 0;
            if (mistakes.length === 0) {
                mistakesBtn.textContent = 'ÈîôÈ¢òÊú¨ (Êó†ÈîôÈ¢ò)';
            } else {
                mistakesBtn.textContent = `ÈîôÈ¢òÊú¨ (${mistakes.length}È¢ò)`;
            }
        }

        // ÊòæÁ§∫ÈîôÈ¢òÊú¨
        function showMistakesModal() {
            const mistakes = answers.filter(answer => !answer.isCorrect && !answer.isSkipped);
            
            if (mistakes.length === 0) {
                mistakesList.innerHTML = '<p style="text-align: center; color: var(--success-color);">üéâ ÊÅ≠ÂñúÔºÅÊú¨Ê¨°Âê¨ÂÜôÊ≤°ÊúâÈîôÈ¢òÔºÅ</p>';
                downloadBtn.disabled = true;
            } else {
                let html = '';
                mistakes.forEach((mistake, index) => {
                    html += `
                        <div class="mistake-item">
                            <div class="mistake-word">
                                <div class="mistake-english">${mistake.question.english}</div>
                                <div class="mistake-chinese">${mistake.question.chinese}</div>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.8rem;">
                                ‰Ω†ÁöÑÁ≠îÊ°à: ${mistake.userAnswer || '(Êú™Â°´ÂÜô)'}
                            </div>
                        </div>
                    `;
                });
                mistakesList.innerHTML = html;
                downloadBtn.disabled = false;
            }
            
            mistakesModal.classList.remove('hidden');
        }

        // ‰∏ãËΩΩExcelÈîôÈ¢òÊú¨
        function downloadMistakesExcel() {
            const mistakes = answers.filter(answer => !answer.isCorrect && !answer.isSkipped);
            
            if (mistakes.length === 0) {
                alert('Ê≤°ÊúâÈîôÈ¢òÂèØ‰ª•‰∏ãËΩΩÔºÅ');
                return;
            }

            // ÂàõÂª∫CSVÂÜÖÂÆπÔºàExcelÂèØ‰ª•Áõ¥Êé•ÊâìÂºÄCSVÊñá‰ª∂Ôºâ
            let csvContent = '\uFEFF'; // BOM for UTF-8
            csvContent += 'Ëã±Êñá,‰∏≠Êñá\n'; // Ë°®Â§¥
            
            mistakes.forEach(mistake => {
                csvContent += `"${mistake.question.english}","${mistake.question.chinese}"\n`;
            });

            // ÂàõÂª∫BlobÂØπË±°
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            // ÁîüÊàêÊñá‰ª∂ÂêçÔºàÂåÖÂê´Êó•ÊúüÂíåÊó∂Èó¥Ôºâ
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN').replace(/\//g, '-');
            const timeStr = now.toLocaleTimeString('zh-CN', { hour12: false }).replace(/:/g, '-');
            const filename = `ÈîôÈ¢òÊú¨_${dateStr}_${timeStr}.csv`;
            
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            downloadBtn.textContent = '‚úÖ ‰∏ãËΩΩÊàêÂäü';
            setTimeout(() => {
                downloadBtn.textContent = 'üì• ‰∏ãËΩΩExcelÈîôÈ¢òÊú¨';
            }, 2000);
        }

        // ÂéÜÂè≤ËÆ∞ÂΩï
        historyBtn.addEventListener('click', () => {
            showHistoryModal();
        });

        closeHistoryModal.addEventListener('click', () => {
            historyModal.classList.add('hidden');
        });

        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) {
                historyModal.classList.add('hidden');
            }
        });

        // ÈîôÈ¢òÊú¨
        mistakesBtn.addEventListener('click', () => {
            showMistakesModal();
        });

        closeMistakesModal.addEventListener('click', () => {
            mistakesModal.classList.add('hidden');
        });

        mistakesModal.addEventListener('click', (e) => {
            if (e.target === mistakesModal) {
                mistakesModal.classList.add('hidden');
            }
        });

        downloadBtn.addEventListener('click', () => {
            downloadMistakesExcel();
        });

        function showHistoryModal() {
            const historyContent = document.getElementById('historyContent');
            
            if (statistics.sessions.length === 0) {
                historyContent.innerHTML = '<p>ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</p>';
            } else {
                let html = '<h3>ÊúÄËøëÁªÉ‰π†ËÆ∞ÂΩï</h3>';
                
                statistics.sessions.slice().reverse().forEach((session, index) => {
                    const date = new Date(session.date).toLocaleString('zh-CN');
                    const modeText = session.mode === 'chineseToEnglish' ? '‰∏≠ËØëËã±' : 'Ëã±ËØë‰∏≠';
                    const difficultyText = {
                        'basic': 'Âü∫Á°Ä',
                        'intermediate': '‰∏≠Á∫ß',
                        'advanced': 'È´òÁ∫ß',
                        'mixed': 'Ê∑∑Âêà'
                    }[session.difficulty];
                    
                    html += `
                        <div style="border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>${date}</strong>
                                <span style="color: var(--primary-color); font-weight: bold;">${session.accuracy}%</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                ${modeText} ¬∑ ${difficultyText} ¬∑ ${session.correctAnswers}/${session.totalQuestions} Ê≠£Á°Æ
                                ${session.hintsUsed > 0 ? ` ¬∑ ${session.hintsUsed} Ê¨°ÊèêÁ§∫` : ''}
                                ${session.questionsSkipped > 0 ? ` ¬∑ ${session.questionsSkipped} Ê¨°Ë∑≥Ëøá` : ''}
                            </div>
                        </div>
                    `;
                });
                
                // ÈîôËØØÁªüËÆ°
                if (Object.keys(statistics.wordErrors).length > 0) {
                    html += '<h3 style="margin-top: 30px;">ÈîôËØØÁªüËÆ°</h3>';
                    const sortedErrors = Object.entries(statistics.wordErrors)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 10);
                    
                    sortedErrors.forEach(([wordKey, count]) => {
                        const [english, chinese] = wordKey.split('-');
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <span>${english} - ${chinese}</span>
                                <span style="color: var(--error-color); font-weight: bold;">${count} Ê¨°</span>
                            </div>
                        `;
                    });
                }
                
                historyContent.innerHTML = html;
            }
            
            historyModal.classList.remove('hidden');
        }

        // ÈáçÊñ∞ÂºÄÂßã
        restartBtn.addEventListener('click', () => {
            // ÈáçÁΩÆÁïåÈù¢
            resultScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            
            // ÈáçÁΩÆÁä∂ÊÄÅ
            currentQuestionIndex = 0;
            score = 0;
            answers = [];
            hintsUsed = 0;
            questionsSkipped = 0;
            
            // ÈáçÁΩÆÈöæÂ∫¶ÊåâÈíÆ
            difficultyBtns.forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-difficulty="basic"]').classList.add('active');
            currentDifficulty = 'basic';
        });

        // Èò≤Ê≠¢È°µÈù¢Âà∑Êñ∞Êó∂‰∏¢Â§±Áä∂ÊÄÅ
        window.addEventListener('beforeunload', (e) => {
            if (currentQuestionIndex > 0 && currentQuestionIndex < questions.length) {
                e.preventDefault();
                e.returnValue = 'Âê¨ÂÜôËøõË°å‰∏≠ÔºåÁ°ÆÂÆöË¶ÅÁ¶ªÂºÄÂêóÔºü';
            }
        });

        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key) {
                case ' ':
                    e.preventDefault();
                    if (!questionCard.classList.contains('hidden') && !isPaused) {
                        pauseBtn.click();
                    }
                    break;
                case 'h':
                case 'H':
                    if (!questionCard.classList.contains('hidden') && !hintBtn.disabled) {
                        hintBtn.click();
                    }
                    break;
                case 's':
                case 'S':
                    if (!questionCard.classList.contains('hidden') && !skipBtn.disabled) {
                        skipBtn.click();
                    }
                    break;
            }
        });
    </script>
</body>
</html>
